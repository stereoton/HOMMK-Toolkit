// ==UserScript==
// @name HkShortcuts
// @version 2012.01.15.11.49.580000
// @description Explorer für HkToolkit
// @author Gelgamek <gelgamek@arcor.de>
// @copyright Gelgamek et al., Artistic License 2.0, http://www.opensource.org/licenses/Artistic-2.0
// @icon http://icons.iconarchive.com/icons/webiconset/mobile/32/maps-icon.png
// @namespace http://mightandmagicheroeskingdoms.ubi.com/play
// @match http://mightandmagicheroeskingdoms.ubi.com/play*
//
// Content Scope Runner:
// @require http://userscripts.org/scripts/source/68059.user.js
// ==/UserScript==

if('undefined' == typeof __PAGE_SCOPE_x_8061a88c_6d32_4965_800a_4110a02a508a_RUN__) { (function page_scope_runner() {
	// If we're _not_ already running in the page, grab the full source
	// of this script.
	var my_src = "(" + page_scope_runner.caller.toString() + ")();";
	
	// Create a script node holding this script, plus a marker that lets us
	// know we are running in the page scope (not the Greasemonkey sandbox).
	// Note that we are intentionally *not* scope-wrapping here.
	var script = document.createElement('script');
	script.setAttribute("type", "text/javascript");
	script.textContent = "var __PAGE_SCOPE_x_8061a88c_6d32_4965_800a_4110a02a508a_RUN__ = true;\n" + my_src;
	
	// Insert the script node into the page, so it will run, and immediately
	// remove it to clean up. Use setTimeout to force execution "outside" of
	// the user script scope completely.
	setTimeout(function() {
		document.body.appendChild(script);
		document.body.removeChild(script);
	}, 0);
})();return; }if(!window.localStorage){Object.defineProperty(window,"localStorage",new (function(){var a=[],b={};Object.defineProperty(b,"getItem",{value:function(c){return c?this[c]:null},writable:false,configurable:false,enumerable:false});Object.defineProperty(b,"key",{value:function(c){return a[c]},writable:false,configurable:false,enumerable:false});Object.defineProperty(b,"setItem",{value:function(c,d){if(!c){return}document.cookie=escape(c)+"="+escape(d)+"; path=/"},writable:false,configurable:false,enumerable:false});Object.defineProperty(b,"length",{get:function(){return a.length},configurable:false,enumerable:false});Object.defineProperty(b,"removeItem",{value:function(d){if(!d){return}var c=new Date();c.setDate(c.getDate()-1);document.cookie=escape(d)+"=; expires="+c.toGMTString()+"; path=/"},writable:false,configurable:false,enumerable:false});this.get=function(){var c;for(var f in b){c=a.indexOf(f);if(c===-1){b.setItem(f,b[f])}else{a.splice(c,1)}delete b[f]}for(a;a.length>0;a.splice(0,1)){b.removeItem(a[0])}for(var d,e,h=0,g=document.cookie.split(/\s*;\s*/);h<g.length;h++){d=g[h].split(/\s*=\s*/);if(d.length>1){b[e=unescape(d[0])]=unescape(d[1]);a.push(e)}}return b};this.configurable=false;this.enumerable=true})())}if("undefined"==typeof window.console){window.console={log:function log(a){return a}}}else{window.console.logNative=window.console.log;window.console.log=function(c,b){if("function"==typeof window.console.logNative){var a=("undefined"!=typeof window.$debug?window.$debug:(("undefined"!=typeof b)?b:0));if(a>=1){window.console.logNative(c)}if(a>1){alert(c)}}return c}}if("undefined"==typeof window.HkLogger){var HkLogger=new Class({log:function log(a){window.console.log(a)}});window.HkLogger=HkLogger}if("undefined"==typeof HkFinder){var HkFinder=new Class({getRecursive:function getRecursive(c,b){var d=this;var a=b;var e=c.split(".");if(!e.every(function(h,g,f){if(!d.hasOwnProperty(h)){return false}d=d.val;if(g+1>=f.length){a=d}return true},null)){return b}return a}})}try{if("undefined"==typeof window.console){window.console={log:function log(a){}}}}catch(ex){}if("undefined"==typeof window.HkStylesGeneric){window.HkStylesGeneric=new Class({initialize:function(){},applyStyles:function applyStyles(){$A(this.styles).each(function(b,a){var d,c=b;if(c.selector.indexOf(".")!=-1||c.selector.indexOf("#")!=-1){d=$$(c.selector)}else{d=$(c.selector.substr(1))}if(d){if("undefined"==typeof d.length){d=[d]}d=$A(d);d.each(function(f,e){window.console.log("Weise Stile zu\u2026");window.console.log(f);window.console.log(c.styles);$each(c.styles,function(g,h){window.console.log("Weise Wert '"+g+"' zu für Stil "+h);if(f.style[h]!=""&&!c.force){window.console.log("Wert existiert bereits, Zuweisung nicht erzwungen\u2026");return}else{window.console.log("Wert existiert bereits, Zuweisung erzwungen\u2026")}window.console.log("Alter Wert: "+f.style[h]);f.style[h]=g})})}})},styles:[{selector:".GradientGreyDarkgreyGrey",styles:{background:"linear-gradient(top, #202020, #040404 20%, #040404 40%, #303030)"}},{selector:".GradientGreyDarkgreyGrey",styles:{background:"-webkit-linear-gradient(top, #202020, #040404 20%, #040404 40%, #303030)"}},{selector:".GradientGreyDarkgreyGrey",styles:{background:"-moz-linear-gradient(top, #202020, #040404 20%, #040404 40%, #303030)"}},{force:true,selector:".Radius5",styles:{"border-radius":"5px"}},{force:true,selector:".Radius5BottomLeft",styles:{"border-bottom-left-radius":"5px"}},{force:true,selector:".Radius10",styles:{"border-radius":"10px"}},{force:true,selector:".Radius10TopLeft",styles:{"border-top-left-radius":"5px"}},{force:true,selector:".Radius10TopRight",styles:{"border-top-right-radius":"5px"}},{force:true,selector:".HkButton",styles:{border:"none"}}]});var HkStylesGeneric=window.HkStylesGeneric}else{window.console.log("[HkStylesGeneric][WARN]Klasse existiert bereits: "+Json.toString(window.HkStylesGeneric))}if("undefined"==typeof $E){function $E(a,b){return($(b)||document).getElement(a)}function $ES(a,b){return($(b)||document).getElementsBySelector(a)}$$.shared={regexp:/^(\w*|\*)(?:#([\w-]+)|\.([\w-]+))?(?:\[(\w+)(?:([!*^$]?=)["']?([^"'\]]*)["']?)?])?$/,xpath:{getParam:function(b,d,e,c){var a=[d.namespaceURI?"xhtml:":"",e[1]];if(e[2]){a.push('[@id="',e[2],'"]')}if(e[3]){a.push('[contains(concat(" ", @class, " "), " ',e[3],' ")]')}if(e[4]){if(e[5]&&e[6]){switch(e[5]){case"*=":a.push("[contains(@",e[4],', "',e[6],'")]');break;case"^=":a.push("[starts-with(@",e[4],', "',e[6],'")]');break;case"$=":a.push("[substring(@",e[4],", string-length(@",e[4],") - ",e[6].length,' + 1) = "',e[6],'"]');break;case"=":a.push("[@",e[4],'="',e[6],'"]');break;case"!=":a.push("[@",e[4],'!="',e[6],'"]')}}else{a.push("[@",e[4],"]")}}b.push(a.join(""));return b},getItems:function(b,e,g){var f=[];var a=document.evaluate(".//"+b.join("//"),e,$$.shared.resolver,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);for(var d=0,c=a.snapshotLength;d<c;d++){f.push(a.snapshotItem(d))}return(g)?f:new Elements(f.map($))}},normal:{getParam:function(a,c,e,b){if(b==0){if(e[2]){var d=c.getElementById(e[2]);if(!d||((e[1]!="*")&&(Element.getTag(d)!=e[1]))){return false}a=[d]}else{a=$A(c.getElementsByTagName(e[1]))}}else{a=$$.shared.getElementsByTagName(a,e[1]);if(e[2]){a=Elements.filterById(a,e[2],true)}}if(e[3]){a=Elements.filterByClass(a,e[3],true)}if(e[4]){a=Elements.filterByAttribute(a,e[4],e[5],e[6],true)}return a},getItems:function(a,b,c){return(c)?a:$$.unique(a)}},resolver:function(a){return(a=="xhtml")?"http://www.w3.org/1999/xhtml":false},getElementsByTagName:function(d,c){var e=[];for(var b=0,a=d.length;b<a;b++){e.extend(d[b].getElementsByTagName(c))}return e}};$$.shared.method=(window.xpath)?"xpath":"normal";Element.Methods.Dom={getElements:function(a,h){var c=[];a=a.trim().split(" ");for(var e=0,d=a.length;e<d;e++){var f=a[e];var g=f.match($$.shared.regexp);if(!g){break}g[1]=g[1]||"*";var b=$$.shared[$$.shared.method].getParam(c,this,g,e);if(!b){break}c=b}return $$.shared[$$.shared.method].getItems(c,this,h)},getElement:function(a){return $(this.getElements(a,true)[0]||false)},getElementsBySelector:function(a,e){var d=[];a=a.split(",");for(var c=0,b=a.length;c<b;c++){d=d.concat(this.getElements(a[c],true))}return(e)?d:$$.unique(d)}};Element.extend({getElementById:function(c){var b=document.getElementById(c);if(!b){return false}for(var a=b.parentNode;a!=this;a=a.parentNode){if(!a){return false}}return b},getElementsByClassName:function(a){return this.getElements("."+a)}});document.extend(Element.Methods.Dom);Element.extend(Element.Methods.Dom)}if("undefined"==typeof Scroller){var Scroller=new Class({options:{area:20,velocity:1,onChange:function(a,b){this.element.scrollTo(a,b)}},initialize:function(b,a){this.setOptions(a);this.element=$(b);this.mousemover=([window,document].contains(b))?$(document.body):this.element},start:function(){this.coord=this.getCoords.bindWithEvent(this);this.mousemover.addListener("mousemove",this.coord)},stop:function(){this.mousemover.removeListener("mousemove",this.coord);this.timer=$clear(this.timer)},getCoords:function(a){this.page=(this.element==window)?a.client:a.page;if(!this.timer){this.timer=this.scroll.periodical(50,this)}},scroll:function(){var a=this.element.getSize();var d=this.element.getPosition();var c={x:0,y:0};for(var b in this.page){if(this.page[b]<(this.options.area+d[b])&&a.scroll[b]!=0){c[b]=(this.page[b]-this.options.area-d[b])*this.options.velocity}else{if(this.page[b]+this.options.area>(a.size[b]+d[b])&&a.scroll[b]+a.size[b]!=a.scrollSize[b]){c[b]=(this.page[b]-a.size[b]+this.options.area-d[b])*this.options.velocity}}}if(c.y||c.x){this.fireEvent("onChange",[a.scroll.x+c.x,a.scroll.y+c.y])}}});Scroller.implement(new Events,new Options)}if(String.prototype.toCurrency==null){String.prototype.toCurrency=function toCurrency(){var b=this.toString();var a=/^(.*\s)?([\-+\u00A3\u20AC]?\d+)(\d{3}\b)/;return b==(b=b.replace(a,"$1$2,$3"))?b:this.toCurrency(b)}}if(String.prototype.padLeft==null){String.prototype.padLeft=function padLeft(b,c){var a=this.toString();while(a.length<b){a=c+a}return a}}if(Number.prototype.toK==null){Number.prototype.toK=function toK(){var b=Number(this.toString());var a=Number(Math.abs(b));if((a.toInt()/1000000)>=1){return b.toFixedString(1000000,1,true)+"M"}if((a.toInt()/1000)>=1){return b.toFixedString(1000)+"K"}return b}}if(Number.prototype.toFixedString==null){Number.prototype.toFixedString=function toFixedString(){var h=this.toString();var g,f,c;var b=Array.prototype.slice.call(arguments);if(b.length>2){g=b.shift()}else{g=1}f=b.shift();c=b.shift();h=h/g;var e=parseFloat((h||"0").toString().replace(",",".").replace(/[^0-9e\.\-+]/g,""))||0;var d=Number(Math.abs(h)).toUnsignedString(f);if(isNaN(d)){d=0}d=(e<0?"-":"")+d;if(c==true){return d.toCurrency()}return Number(d)}}if(Number.prototype.toFixedString==null){Number.prototype.toUnsignedString=function toUnsignedString(c){var f=this.toString();var e,a,b;var d=""+Math.round(f*Math.pow(10,c));if(/\D/.test(d)){return""+f}d=d.padLeft(1+c,"0");e=d.substring(0,b=(d.length-c));a=d.substring(b);if(a){a="."+a}return e+a}}if(Node.prototype.preventTextSelection==null){var applyToTags=["p","h1","h2","h3","h4","h5","h6","li","a","img"];Node.prototype.preventTextSelection=function(b){if($type(this)!="element"){return this}if(!applyToTags.contains(this.getTag())){return this}var a={"-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-o-user-select":"none","user-select":"none"};this.setStyles(a);return this}}window.HkStylesExtra={Shortcuts:{list:{paddingTop:"2px",paddingBottom:"2px",marginLeft:"0px",marginRight:"0px",marginTop:"0px",marginBottom:"0px",clear:"both","float":"none",backgroundColor:"#0e0e0e",height:"auto",maxHeight:"800px",width:"auto",maxWidth:"1200px"},Form:{inputX:{verticalAlign:"middle"},inputY:{verticalAlign:"middle"},inputName:{verticalAlign:"middle",width:"90%"},submit:{margin:"0px",verticalAlign:"middle",cursor:"pointer"},load:{margin:"0px",verticalAlign:"middle",cursor:"pointer"},gotoPosition:{margin:"0px",verticalAlign:"middle",cursor:"pointer"},error:{},valid:{}},Entry:{deleteButton:{cursor:"pointer","float":"right",paddingTop:"3px"},text:{cursor:"pointer",width:"auto",marginLeft:"2px",marginRight:"20px",paddingTop:"3px",paddingBottom:"3px"},entry:{padding:"2px 0px",borderTop:"1px solid #303030",clear:"both"}},},window:{zIndex:"95000",margin:"auto",display:"block",position:"absolute",border:"1px solid #000","border-top-left-radius":"5px","border-top-right-radius":"5px",top:"50px",left:"auto",bottom:"auto",right:"auto",width:"auto",height:"auto",backgroundColor:"#0e0e0e",color:"#f2f2f2",overflow:"none",paddingBottom:"0px",borderTopLeftRadius:"10px",borderTopRightRadius:"10px",borderBottomLeftRadius:"5px"},footer:{clear:"both","float":"none",marginTop:"0px",paddingTop:"3px",paddingBottom:"0px",marginBottom:"0px",marginLeft:"0px",marginRight:"0px",height:"auto",width:"100%",backgroundColor:"#1a1a1a"},donate:{display:"block","float":"right",width:"auto",marginLeft:"auto"},scrollArea:{"float":"left",marginLeft:"0px",height:"16px",width:"auto",},scrollButton:{cursor:"pointer"},content:{margin:"0px",marginBottom:"0px",paddingTop:"2px",paddingBottom:"2px",overflow:"hidden",height:"48px",minHeight:"32px",maxHeight:"800px",width:"160px",minWidth:"120px",maxWidth:"1200px"},header:{zIndex:"96000",marginTop:"0px",marginBottom:"5px",paddingTop:"1px",paddingBottom:"1px",paddingLeft:"5px",paddingRight:"5px",borderTopLeftRadius:"10px",borderTopRightRadius:"10px",backgroundColor:"#1a1a1a"},title:{fontSize:"0.8em",paddingLeft:"3px",backgroundColor:"transparent",paddingBottom:"2px",marginTop:"4px",marginBottom:"2px",marginRight:"auto",width:"auto"},reduceButton:{zIndex:"97000",cursor:"pointer","float":"right",width:"22px",height:"18px",backgroundPosition:"-110px",backgroundRepeat:"no-repeat",backgroundImage:'url("http://cgit.compiz.org/fusion/decorators/emerald/plain/defaults/theme/buttons.min.png")'},updateLink:{zIndex:"97000",verticalAlign:"middle","float":"right",paddingTop:"2px",fontSize:"0px"},updateButton:{zIndex:"97000",border:" none"},resizeButton:{zIndex:"97000",verticalAlign:"middle","float":"right",cursor:"se-resize",border:" none",width:"12px",height:"12px",backgroundPosition:"0px 0px",backgroundImage:"url(http://openiconlibrary.sourceforge.net/gallery2/open_icon_library-full/icons_by_subject/graphics/png/32x32/cursor-corner-bottom-right.png)"},closeButton:{}};window.$debug=window.$debug||0;window.hkCreateExplorer=function(){try{window.explorerAssetLoader=new AssetLoader({SHA256CryptoJs:{url:"http://crypto-js.googlecode.com/files/2.5.3-crypto-sha256.js"}})}catch(i){window.console.log("[ExplorerAssetLoader][ERROR]"+i)}var f=window.Hk;var c=window.hk;window.HOMMK_HkExplorer=window.HOMMK_HkExplorer?window.HOMMK_HkExplorer:{version:c.version};var j=c.HOMMK;var e=c.idScript;var h=c.version;window.console.log("[PUBLIC][DEBUG]Starte HkExplorer\u2026");f.HkExplorer=new Class({$hkWin:false,inputStyles:{valid:{border:"1px solid #030303"},error:{border:"1px solid #fa0c0c"}},initialize:function(l){this.setOptions(l);window.console.log("[HkExplorer][DEBUG]Initialisiere\u2026");window.console.log("[HkExplorer][DEBUG]Initialisiere\u2026");try{this.$hkWin=window.hk.Windows.createWindow("HkExplorer",{title:"HkExplorer",updateable:false});window.console.log("[HkExplorer][DEBUG]Erzeuge Content\u2026");window.console.log("[HkExplorer][DEBUG]Erzeuge Content\u2026");this.createContent()}catch(m){window.console.log("[HkExplorer][DEBUG]Fehler bei der Initialisierung: "+m);window.console.log("[HkExplorer][DEBUG]Fehler bei der Initialisierung: "+m)}},createContent:function g(){var l=this.$hkWin.getElement(".HkContent");l.setStyle("paddingTop","0px");var m=this.getCities();window.console.log(m);window.console.log(window.HOMMK.player);window.console.log(window.HOMMK)},getCities:function d(){if($chk(window.HOMMK.worldMap.regionList)){var l=window.HOMMK.worldMap.regionList.elementList;var m=$A(l).filter(function(o,n){if(o&&"undefined"!=typeof o.contents){return o.contents.hasOwnProperty("cN")}return false});window.console.log(m)}},updateExplorer:function k(){},updateDimensions:function a(){}});f.HkExplorer.implement(new Events,new Options);var b=function(){try{window.console.log("[HkPublic][DEBUG]Erzeuge Explorer-Fenster");window.hk.Explorer=window.hk.hkExplorer||new window.Hk.HkExplorer()}catch(l){window.console.log("[HkPublic][ERROR]Fehler beim Erzeugen des Explorer-Fensters: "+l)}try{window.hk.Explorer.updateExplorer()}catch(l){window.console.log("[HkPublic][ERROR]Fehler beim Aktualisieren des Explorer-Fensters: "+l)}try{window.hk.Windows.makeReduceable("HkExplorer",{reduce:$("HkWindowContentHkExplorer"),title:"HkExplorer"});window.hk.Windows.makeScrollable("HkExplorer",{scroll:$("HkWindowContentHkExplorer"),title:"HkExplorer"});window.hk.Explorer.updateDimensions()}catch(l){window.hk.Explorer.log("[HkPublic][ERROR]Fehler bei der Finalisierung des Explorer-Fensters: "+l)}if("undefined"==typeof window.hkStylesGeneric){try{window.hkStylesGeneric=new window.HkStylesGeneric()}catch(l){window.console.log("[HkPublic][ERROR]Fehler bei der Finalisierung des Shortcuts-Fensters: "+l)}}window.hkStylesGeneric.applyStyles()};return b()};try{if(!$type(console)){var console={log:function log(a){}}}}catch(ex){}window.console.log("Erzeuge Loader-Objekt\u2026");window.HkExplorerLoader={loaded:false,load:function load(){if(window.HkExplorerLoader.loaded){window.console.log("[HkExplorerLoader][DEBUG]HkExplorer geladen\u2026");try{window.HkExplorerLoaderActive=$clear(window.HkExplorerLoaderActive);delete window.HkExplorerLoader}catch(b){window.console.log("[HkExplorerLoader][Error]Fehler beim Beenden des Loaders: "+b)}return}console.log("[HkPublic][DEBUG]Warte auf Toolkit\u2026");if(!!(window.hkCreateExplorer&&window.initHkToolkit&&window.hk&&window.AssetLoader&&window.assetLoader&&window.assetLoader.waiting.length==0)){window.console.log("[HkExplorerLoader][DEBUG]Toolkit verfügbar, bereite HkExplorer vor\u2026");try{window.HkExplorerLoader.loaded=true;var a=window.hkCreateExplorer();a()}catch(b){window.console.log("[HkExplorerLoader][ERROR]Fehler beim Erzeugen der Klassen für HkExplorer: "+b)}}else{window.console.log("[HkExplorerLoader][DEBUG]HkExplorer wartet auf die Verfügbarkeit von HkToolkit.")}}};window.console.log("Starte Loader\u2026");try{window.HkExplorerLoaderActive=window.HkExplorerLoader.load.periodical(1000)}catch(ex){window.console.log("[HkPublic][DEBUG]Fehler beim Laden von HkExplorer: "+ex)};