// ==UserScript==
// @name HkExplorer
// @version 2012.01.27.19.51.05
//
// @description Explorer für HkToolkit :: Werkzeugkasten für MMHK/HOMMK
//
// @author Gelgamek <gelgamek@arcor.de>
// @copyright Gelgamek et al., Artistic License 2.0, http://www.opensource.org/licenses/Artistic-2.0
//
// @updateURL		https://github.com/gelgamek/HOMMK-Toolkit/raw/TESTING/hommk_meta.user.js
// @installURL  https://github.com/gelgamek/HOMMK-Toolkit/raw/RELEASE/hommk_meta.user.js
//
// @icon 				http://icons.iconarchive.com/icons/arrioch/senary/32/System-search-icon.png
// @namespace 	http://mightandmagicheroeskingdoms.ubi.com/play
// @match 			http://mightandmagicheroeskingdoms.ubi.com/play*
//
// Content Scope Runner:
// @require 		http://userscripts.org/scripts/source/68059.user.js
// ==/UserScript==

if('undefined' == typeof __PAGE_SCOPE__RUN__) { (function page_scope_runner(){var b="("+page_scope_runner.caller.toString()+")();";var a=document.createElement("script");a.setAttribute("type","text/javascript");a.textContent="var __PAGE_SCOPE__RUN__ = true;\n"+b;setTimeout(function(){document.body.appendChild(a);document.body.removeChild(a)},0)})();return; }if(!window.localStorage){Object.defineProperty(window,"localStorage",new (function(){var a=[],b={};Object.defineProperty(b,"getItem",{value:function(c){return c?this[c]:null},writable:false,configurable:false,enumerable:false});Object.defineProperty(b,"key",{value:function(c){return a[c]},writable:false,configurable:false,enumerable:false});Object.defineProperty(b,"setItem",{value:function(c,e){if(!c){return}document.cookie=escape(c)+"="+escape(e)+"; path=/"},writable:false,configurable:false,enumerable:false});Object.defineProperty(b,"length",{get:function(){return a.length},configurable:false,enumerable:false});Object.defineProperty(b,"removeItem",{value:function(e){if(!e){return}var c=new Date();c.setDate(c.getDate()-1);document.cookie=escape(e)+"=; expires="+c.toGMTString()+"; path=/"},writable:false,configurable:false,enumerable:false});this.get=function(){var c;for(var g in b){c=a.indexOf(g);if(c===-1){b.setItem(g,b[g])}else{a.splice(c,1)}delete b[g]}for(a;a.length>0;a.splice(0,1)){b.removeItem(a[0])}for(var e,f,i=0,h=document.cookie.split(/\s*;\s*/);i<h.length;i++){e=h[i].split(/\s*=\s*/);if(e.length>1){b[f=unescape(e[0])]=unescape(e[1]);a.push(f)}}return b};this.configurable=false;this.enumerable=true})())}if("undefined"==typeof window.console){window.console={log:function log(a){return a}}}else{if("undefined"==typeof window.console.logNative){window.console.logNative=window.console.log;window.console.log=function(e,b){if("function"==typeof window.console.logNative){var a=("undefined"!=typeof window.$debug?window.$debug:(("undefined"!=typeof b)?b:0));if(a>=1){try{window.console.logNative(e)}catch(c){}}if(a>1){alert(e)}}return e}}}if("undefined"==typeof window.HkLogger){var HkLogger=new Class({log:function log(b){try{window.console.log(b)}catch(a){}}});window.HkLogger=HkLogger}WebFontConfig={google:{families:["Ubuntu:400,300,500,700:latin,latin-ext","Ubuntu+Mono:400:latin,latin-ext","Ubuntu+Condensed::latin,latin-ext","Jura:400,300,500,600:latin,latin-ext"]}};(function(){var a=document.createElement("script");a.src=("https:"==document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js";a.type="text/javascript";a.async="true";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)})();if("undefined"==typeof HkFinder){var HkFinder=new Class({getRecursive:function getRecursive(c,b){var e=this;var a=b;var f=c.split(".");if(!f.every(function(i,h,g){if(!e.hasOwnProperty(i)){return false}e=e.val;if(h+1>=g.length){a=e}return true},null)){return b}return a}})}if("undefined"==typeof window.addStylesheetRules){if("undefined"==typeof window.globalStylesApplied){window.globalStylesApplied=false}window.addStylesheetRules=function(n){if(window.globalStylesApplied){return}var a=document.createElement("style");var o=document.styleSheets[document.styleSheets.length-1];for(var f=0,h=n.length;f<h;f++){var e=1,m=n[f],c=m[0],b="";if($type(m[1][0])=="array"){m=m[1];e=0}for(var k=m.length;e<k;e++){var l=m[e];if($type(l)=="string"){if(e>1){return}var g=l.match(/(.*)[:](.*)/);if(!g||g.length==0){}l=[g[1],g[2],m[2]]}b+=l[0]+":"+l[1]+(l[2]?" !important":"")+";\n"}if(o.insertRule){o.insertRule(c+"{"+b+"}",o.cssRules.length)}else{o.addRule(c,b,-1)}}window.globalStylesApplied=true}}try{if("undefined"==typeof window.console){window.console={log:function log(a){}}}}catch(ex){}if("undefined"==typeof hkSetAbove){var hkSetAbove=function(a){if("undefined"==typeof a){a=250}return""+(95000+a)+""}}if("undefined"==typeof hkSetBelow){var hkSetBelow=function(a){if("undefined"==typeof a){a=250}return""+(95000-a)+""}}if("undefined"==typeof hkGetMaxHeight){hkGetMaxHeight=function(a){if("undefined"==typeof a){a=1.25}return(parseInt(window.getHeight())/a)+"px"}}if("undefined"==typeof hkGetMaxWidth){var hkGetMaxWidth=function(a){if("undefined"==typeof a){a=1.25}return(parseInt(window.getWidth())/a)+"px"}}if("undefined"==typeof window.HkStylesGeneric){window.HkStylesGeneric=new Class({initialize:function(){},applyStyles:function applyStyles(b){if(("undefined"!=typeof b&&!b)||"undefined"==typeof addStylesheetRules){$A(this.styles).each(function(e,c){var g,f=e;if(f.selector.indexOf(".")!=-1||f.selector.indexOf("#")!=-1){g=$$(f.selector)}else{g=$(f.selector.substr(1))}if(g){if("undefined"==typeof g.length){g=[g]}g=$A(g);g.each(function(i,h){$each(f.styles,function(j,k){if(i.style[k]!=""&&!f.force){return}i.style[k]=j})})}})}else{window.console.log("[HkGenericStyles][DEBUG]Benutze dokumentweite Styles...");var a=[];this.styles.each(function(g){window.console.log("[HkGenericStyles][DEBUG]Verarbeite Stildefinition:");window.console.log(g);var e=g.styles;window.console.log("[HkGenericStyles][DEBUG]Definierte Styles:");window.console.log(e);for(var j in e){window.console.log("[HkGenericStyles][DEBUG]Erzeuge Style-Regel:");window.console.log(j);var i="";var f=e[j];window.console.log("[HkGenericStyles][DEBUG]Verarbeite:");window.console.log(f);var h=false;window.console.log("[HkGenericStyles][DEBUG]Prüfe '!important'");if(f.test(/\!important/)){var c=f.match(/(.*)(\!important)(.*)/);f=c[1]+c[3]}i+=j+":"+f+";";window.console.log("[HkGenericStyles][DEBUG]Erzeugter Stil:");window.console.log(i);var k=[g.selector,i,h];window.console.log("[HkGenericStyles][DEBUG]Erzeugte Stilregel:");window.console.log(k);a.push(k)}});window.console.log("[HkGenericStyles][DEBUG]Wende Stilregeln an:");window.console.log(a);window.addStylesheetRules(a)}},styles:[{selector:".GradientGreyDarkgreyGrey",styles:{background:"linear-gradient(top, #202020, #040404 20%, #040404 40%, #303030)"}},{selector:".GradientGreyDarkgreyGrey",styles:{background:"-webkit-linear-gradient(top, #202020, #040404 20%, #040404 40%, #303030)"}},{selector:".GradientGreyDarkgreyGrey",styles:{background:"-moz-linear-gradient(top, #202020, #040404 20%, #040404 40%, #303030)"}},{force:true,selector:".Radius5",styles:{"border-radius":"5px"}},{force:true,selector:".Radius5BottomLeft",styles:{"border-bottom-left-radius":"5px"}},{force:true,selector:".Radius10",styles:{"border-radius":"10px"}},{force:true,selector:".Radius10TopLeft",styles:{"border-top-left-radius":"5px"}},{force:true,selector:".Radius10TopRight",styles:{"border-top-right-radius":"5px"}},{selector:".HkButton",styles:{border:"none",zIndex:hkSetAbove(1000),cursor:"pointer"}},{force:true,selector:".maxHeight125",styles:{maxHeight:hkGetMaxHeight(1.25)+"px",}},{},{force:true,selector:".above50",styles:{zIndex:hkSetAbove(50)}},{force:true,selector:".above1000",styles:{zIndex:hkSetAbove(1000)}},{force:true,selector:".above1500",styles:{zIndex:hkSetAbove(1500)}},{force:true,selector:".above250",styles:{zIndex:hkSetAbove(250)}},{force:true,selector:"#HkWindowHkExplorer",styles:{height:"auto",minWidth:"240px"}},{force:true,selector:"#HkWindowContentHkExplorer",styles:{height:"auto",minHeight:"60px"}},{force:true,selector:".alignCenter",styles:{"text-align":"center"}},{force:true,selector:".alignRight",styles:{"text-align":"right"}},{force:true,selector:".alignLeft",styles:{"text-align":"left"}},{selector:".HkListContainer",styles:{height:"auto"}},{selector:".HkList",styles:{border:"none",padding:"0px","background-color":"#0e0e0e"}},{selector:".HkListEntry",styles:{padding:"1px 0px",}},{force:true,selector:".HkWindowResizeButton",styles:{opacity:"0.5",}},{selector:".HkListText",styles:{"font-family":"monospace",cursor:"pointer",padding:"3px 20px 3px 2px","font-size":"0.95em"}},{selector:".HkListCategory",styles:{padding:"4px 2px","border-top":"1px solid #252525","border-bottom":"2px solid #505050","font-family":'"Ubuntu", sans-serif',"font-weight":"400"}},{force:true,selector:".HkWindow",styles:{"font-family":'"Ubuntu", sans-serif',"font-weight":"300"}},{force:true,selector:".HkWindowHeader",styles:{"font-family":'"Jura", sans-serif',"font-size":"1.1em","font-weight":"500"}},{force:true,selector:".HkWindow code, .HkWindow pre",styles:{"font-family":'"Ubuntu Mono", monospace',"font-weight":"400"}}]});if("undefined"==typeof HkStylesGeneric){var HkStylesGeneric=window.HkStylesGeneric}}if("undefined"==typeof $E){function $E(a,b){return($(b)||document).getElement(a)}function $ES(a,b){return($(b)||document).getElementsBySelector(a)}$$.shared={regexp:/^(\w*|\*)(?:#([\w-]+)|\.([\w-]+))?(?:\[(\w+)(?:([!*^$]?=)["']?([^"'\]]*)["']?)?])?$/,xpath:{getParam:function(b,e,f,c){var a=[e.namespaceURI?"xhtml:":"",f[1]];if(f[2]){a.push('[@id="',f[2],'"]')}if(f[3]){a.push('[contains(concat(" ", @class, " "), " ',f[3],' ")]')}if(f[4]){if(f[5]&&f[6]){switch(f[5]){case"*=":a.push("[contains(@",f[4],', "',f[6],'")]');break;case"^=":a.push("[starts-with(@",f[4],', "',f[6],'")]');break;case"$=":a.push("[substring(@",f[4],", string-length(@",f[4],") - ",f[6].length,' + 1) = "',f[6],'"]');break;case"=":a.push("[@",f[4],'="',f[6],'"]');break;case"!=":a.push("[@",f[4],'!="',f[6],'"]')}}else{a.push("[@",f[4],"]")}}b.push(a.join(""));return b},getItems:function(b,f,h){var g=[];var a=document.evaluate(".//"+b.join("//"),f,$$.shared.resolver,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);for(var e=0,c=a.snapshotLength;e<c;e++){g.push(a.snapshotItem(e))}return(h)?g:new Elements(g.map($))}},normal:{getParam:function(a,c,f,b){if(b==0){if(f[2]){var e=c.getElementById(f[2]);if(!e||((f[1]!="*")&&(Element.getTag(e)!=f[1]))){return false}a=[e]}else{a=$A(c.getElementsByTagName(f[1]))}}else{a=$$.shared.getElementsByTagName(a,f[1]);if(f[2]){a=Elements.filterById(a,f[2],true)}}if(f[3]){a=Elements.filterByClass(a,f[3],true)}if(f[4]){a=Elements.filterByAttribute(a,f[4],f[5],f[6],true)}return a},getItems:function(a,b,c){return(c)?a:$$.unique(a)}},resolver:function(a){return(a=="xhtml")?"http://www.w3.org/1999/xhtml":false},getElementsByTagName:function(e,c){var f=[];for(var b=0,a=e.length;b<a;b++){f.extend(e[b].getElementsByTagName(c))}return f}};$$.shared.method=(window.xpath)?"xpath":"normal";Element.Methods.Dom={getElements:function(a,k){var c=[];a=a.trim().split(" ");for(var f=0,e=a.length;f<e;f++){var g=a[f];var h=g.match($$.shared.regexp);if(!h){break}h[1]=h[1]||"*";var b=$$.shared[$$.shared.method].getParam(c,this,h,f);if(!b){break}c=b}return $$.shared[$$.shared.method].getItems(c,this,k)},getElement:function(a){return $(this.getElements(a,true)[0]||false)},getElementsBySelector:function(a,f){var e=[];a=a.split(",");for(var c=0,b=a.length;c<b;c++){e=e.concat(this.getElements(a[c],true))}return(f)?e:$$.unique(e)}};Element.extend({getElementById:function(c){var b=document.getElementById(c);if(!b){return false}for(var a=b.parentNode;a!=this;a=a.parentNode){if(!a){return false}}return b},getElementsByClassName:function(a){return this.getElements("."+a)}});document.extend(Element.Methods.Dom);Element.extend(Element.Methods.Dom)}if("undefined"==typeof Scroller){var Scroller=new Class({options:{area:20,velocity:1,onChange:function(a,b){this.element.scrollTo(a,b)}},initialize:function(b,a){this.setOptions(a);this.element=$(b);this.mousemover=([window,document].contains(b))?$(document.body):this.element},start:function(){this.coord=this.getCoords.bindWithEvent(this);this.mousemover.addListener("mousemove",this.coord)},stop:function(){this.mousemover.removeListener("mousemove",this.coord);this.timer=$clear(this.timer)},getCoords:function(a){this.page=(this.element==window)?a.client:a.page;if(!this.timer){this.timer=this.scroll.periodical(50,this)}},scroll:function(){var a=this.element.getSize();var e=this.element.getPosition();var c={x:0,y:0};for(var b in this.page){if(this.page[b]<(this.options.area+e[b])&&a.scroll[b]!=0){c[b]=(this.page[b]-this.options.area-e[b])*this.options.velocity}else{if(this.page[b]+this.options.area>(a.size[b]+e[b])&&a.scroll[b]+a.size[b]!=a.scrollSize[b]){c[b]=(this.page[b]-a.size[b]+this.options.area-e[b])*this.options.velocity}}}if(c.y||c.x){this.fireEvent("onChange",[a.scroll.x+c.x,a.scroll.y+c.y])}}});Scroller.implement(new Events,new Options)}if(String.prototype.toCurrency==null){String.prototype.toCurrency=function toCurrency(){var b=this.toString();var a=/^(.*\s)?([\-+\u00A3\u20AC]?\d+)(\d{3}\b)/;return b==(b=b.replace(a,"$1$2,$3"))?b:this.toCurrency(b)}}if("undefined"==typeof stringPadLeft){var stringPadLeft=function(c,a,b){if(b==null||"undefined"==typeof b){b=" "}while(c.length<a){c=String(b)+String(c)}return c}}if("undefined"==typeof stringPadRight){var stringPadRight=function(c,a,b){if(b==null||"undefined"==typeof b){b=" "}while(c.length<a){c=String(c)+String(b)}return c}}if(String.prototype.padLeft==null||String.padLeft==null){String.prototype.padLeft=function(a,b){if(b==null||"undefined"==typeof b){b=" "}return stringPadLeft(this.toString,a,b)}}if(String.prototype.padRight==null||String.padRight==null){String.prototype.padRight=function(a,b){if(b==null||"undefined"==typeof b){b=" "}return stringPadRight(this.toString(),a,b)}}if(String.prototype.removeAtLeft==null){String.prototype.removeAtLeft=function(a){if(a==null||"undefined"==typeof a){a="0"}var b=this.toString();while(b.charAt(0)===a){b=b.substr(1)}return b}}if(Number.prototype.toK==null){Number.prototype.toK=function toK(){var b=Number(this.toString());var a=Number(Math.abs(b));if((a.toInt()/1000000)>=1){return b.toFixedString(1000000,1,true)+"M"}if((a.toInt()/1000)>=1){return b.toFixedString(1000)+"K"}return b}}if(Number.prototype.toFixedString==null){Number.prototype.toFixedString=function toFixedString(){var i=this.toString();var h,g,c;var b=Array.prototype.slice.call(arguments);if(b.length>2){h=b.shift()}else{h=1}g=b.shift();c=b.shift();i=i/h;var f=parseFloat((i||"0").toString().replace(",",".").replace(/[^0-9e\.\-+]/g,""))||0;var e=Number(Math.abs(i)).toUnsignedString(g);if(isNaN(e)){e=0}e=(f<0?"-":"")+e;if(c==true){return e.toCurrency()}return Number(e)}}if(Number.prototype.toFixedString==null){Number.prototype.toUnsignedString=function toUnsignedString(c){var g=this.toString();var f,a,b;var e=""+Math.round(g*Math.pow(10,c));if(/\D/.test(e)){return""+g}e=e.padLeft(1+c,"0");f=e.substring(0,b=(e.length-c));a=e.substring(b);if(a){a="."+a}return f+a}}if(Node.prototype.preventTextSelection==null){var applyToTags=["p","h1","h2","h3","h4","h5","h6","li","a","img"];Node.prototype.preventTextSelection=function(b){if($type(this)!="element"){return this}if(!applyToTags.contains(this.getTag())){return this}var a={"-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-o-user-select":"none","user-select":"none"};this.setStyles(a);return this}}window.HkStylesExtra={Shortcuts:{list:{padding:"2px 0px",margin:"0px",clear:"both","float":"none",backgroundColor:"#0e0e0e",height:"auto",width:"auto"},Form:{inputX:{verticalAlign:"middle"},inputY:{verticalAlign:"middle"},inputName:{verticalAlign:"middle",width:"90%"},submit:{margin:"0px",verticalAlign:"middle",cursor:"pointer"},load:{margin:"0px",verticalAlign:"middle",cursor:"pointer"},gotoPosition:{margin:"0px",verticalAlign:"middle",cursor:"pointer"},error:{},valid:{}},Entry:{deleteButton:{cursor:"pointer","float":"right",paddingTop:"3px"},text:{cursor:"pointer",width:"auto",marginLeft:"2px",marginRight:"20px",paddingTop:"3px",paddingBottom:"3px"},entry:{padding:"2px 0px",borderTop:"1px solid #303030",clear:"both"}},},window:{zIndex:"95000",margin:"auto",display:"block",position:"absolute",border:"1px solid #000","border-top-left-radius":"5px","border-top-right-radius":"5px",top:"50px",left:"auto",bottom:"auto",right:"auto",width:"auto",height:"auto",backgroundColor:"#0e0e0e",color:"#f2f2f2",overflow:"none",paddingBottom:"0px",borderTopLeftRadius:"10px",borderTopRightRadius:"10px",borderBottomLeftRadius:"5px",opacity:"0.8"},footer:{clear:"both","float":"none",margin:"0px",paddingTop:"3px 0px 0px 0px",height:"auto",width:"100%",backgroundColor:"#1a1a1a"},donate:{display:"block","float":"right",width:"auto",marginLeft:"auto"},scrollArea:{"float":"left",marginLeft:"0px",height:"16px",width:"auto",},scrollButton:{cursor:"pointer"},content:{margin:"0px",padding:"2px 0px",overflow:"hidden",height:"auto",width:"auto",minHeight:"80px",minWidth:"120px",maxHeight:parseInt(window.getHeight())/1.25+"px",maxWidth:parseInt(window.getWidth())/1.25+"px"},header:{zIndex:"95000",marginTop:"0px 0px 5px 0px",padding:"1px 5px",borderTopLeftRadius:"10px",borderTopRightRadius:"10px",backgroundColor:"#1a1a1a"},title:{fontSize:"0.8em",padding:"0px 0px 2px 3px",backgroundColor:"transparent",margin:"4px auto 2px",width:"auto"},reduceButton:{"float":"right",width:"22px",height:"18px",backgroundPosition:"-110px",backgroundRepeat:"no-repeat",backgroundImage:'url("http://cgit.compiz.org/fusion/decorators/emerald/plain/defaults/theme/buttons.min.png")'},updateLink:{verticalAlign:"middle","float":"right",paddingTop:"2px",fontSize:"0px"},updateButton:{border:" none"},resizeButton:{verticalAlign:"middle","float":"right",cursor:"se-resize",border:" none",width:"12px",height:"12px",backgroundPosition:"0px 0px",backgroundImage:"url(http://openiconlibrary.sourceforge.net/gallery2/open_icon_library-full/icons_by_subject/graphics/png/32x32/cursor-corner-bottom-right.png)"},closeButton:{}};if("undefined"==typeof AssetLoader){var AssetLoader=new Class({initialize:function(a){this.completed=[];this.waiting=[];if(!!a){this.injectJavascript(a)}},injectJavascript:function injectJavascript(a){this.scriptsToInject=a;$each(a,function(b,c){this.waiting.push(c)},this);$each(a,function(b,c){if(!$(c)){this.inject(b,c)}else{this.setInjected(c)}},this)},inject:function inject(scriptDef,scriptName){if($(scriptName)){$(scriptName).remove()}var url=scriptDef.hasOwnProperty("url")?scriptDef.url:false;var conditions=scriptDef.hasOwnProperty("conditions")?eval(scriptDef.conditions):true;if(url&&conditions&&!$(scriptName)){new Asset.javascript(url,{id:scriptName})}this.check.delay(200,this,[scriptDef,scriptName])},check:function check(scriptDef,scriptName){var conditions=scriptDef.hasOwnProperty("conditions")?eval(scriptDef.conditions):false;if(conditions){this.inject.delay(1000,this,[scriptDef,scriptName])}else{this.setInjected(scriptName)}},setInjected:function setInjected(a){this.completed.push(a);this.waiting.remove(a)}})}if("undefined"==typeof window.HkCommonsAssetLoader){try{window.HkCommonsAssetLoader=new AssetLoader({})}catch(ex){}}(typeof Crypto=="undefined"||!Crypto.util)&&function(){var c=window.Crypto={},a=c.util={rotl:function(e,f){return e<<f|e>>>32-f},rotr:function(e,f){return e<<32-f|e>>>f},endian:function(e){if(e.constructor==Number){return a.rotl(e,8)&16711935|a.rotl(e,24)&4278255360}for(var f=0;f<e.length;f++){e[f]=a.endian(e[f])}return e},randomBytes:function(e){for(var f=[];e>0;e--){f.push(Math.floor(Math.random()*256))}return f},bytesToWords:function(e){for(var f=[],h=0,g=0;h<e.length;h++,g+=8){f[g>>>5]|=(e[h]&255)<<24-g%32}return f},wordsToBytes:function(e){for(var f=[],g=0;g<e.length*32;g+=8){f.push(e[g>>>5]>>>24-g%32&255)}return f},bytesToHex:function(e){for(var f=[],g=0;g<e.length;g++){f.push((e[g]>>>4).toString(16)),f.push((e[g]&15).toString(16))}return f.join("")},hexToBytes:function(e){for(var f=[],g=0;g<e.length;g+=2){f.push(parseInt(e.substr(g,2),16))}return f},bytesToBase64:function(e){if(typeof btoa=="function"){return btoa(b.bytesToString(e))}for(var f=[],i=0;i<e.length;i+=3){for(var h=e[i]<<16|e[i+1]<<8|e[i+2],g=0;g<4;g++){i*8+g*6<=e.length*8?f.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(h>>>6*(3-g)&63)):f.push("=")}}return f.join("")},base64ToBytes:function(e){if(typeof atob=="function"){return b.stringToBytes(atob(e))}for(var e=e.replace(/[^A-Z0-9+\/]/ig,""),f=[],h=0,g=0;h<e.length;g=++h%4){g!=0&&f.push(("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(h-1))&Math.pow(2,-2*g+8)-1)<<g*2|"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(e.charAt(h))>>>6-g*2)}return f}},c=c.charenc={};c.UTF8={stringToBytes:function(e){return b.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(b.bytesToString(e)))}};var b=c.Binary={stringToBytes:function(e){for(var f=[],g=0;g<e.length;g++){f.push(e.charCodeAt(g)&255)}return f},bytesToString:function(e){for(var f=[],g=0;g<e.length;g++){f.push(String.fromCharCode(e[g]))}return f.join("")}}}();(function(){var k=Crypto,i=k.util,j=k.charenc,e=j.UTF8,h=j.Binary,n=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],m=k.SHA256=function(a,g){var f=i.wordsToBytes(m._sha256(a));return g&&g.asBytes?f:g&&g.asString?h.bytesToString(f):i.bytesToHex(f)};m._sha256=function(D){D.constructor==String&&(D=e.stringToBytes(D));var C=i.bytesToWords(D),B=D.length*8,D=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],A=[],z,u,c,x,p,l,b,F,y,v,w;C[B>>5]|=128<<24-B%32;C[(B+64>>9<<4)+15]=B;for(F=0;F<C.length;F+=16){B=D[0];z=D[1];u=D[2];c=D[3];x=D[4];p=D[5];l=D[6];b=D[7];for(y=0;y<64;y++){y<16?A[y]=C[y+F]:(v=A[y-15],w=A[y-2],A[y]=((v<<25|v>>>7)^(v<<14|v>>>18)^v>>>3)+(A[y-7]>>>0)+((w<<15|w>>>17)^(w<<13|w>>>19)^w>>>10)+(A[y-16]>>>0));w=B&z^B&u^z&u;var E=(B<<30|B>>>2)^(B<<19|B>>>13)^(B<<10|B>>>22);v=(b>>>0)+((x<<26|x>>>6)^(x<<21|x>>>11)^(x<<7|x>>>25))+(x&p^~x&l)+n[y]+(A[y]>>>0);w=E+w;b=l;l=p;p=x;x=c+v>>>0;c=u;u=z;z=B;B=v+w>>>0}D[0]+=B;D[1]+=z;D[2]+=u;D[3]+=c;D[4]+=x;D[5]+=p;D[6]+=l;D[7]+=b}return D};m._blocksize=16;m._digestsize=32})();if("undefined"==typeof sprintf){var sprintf=(function(){function a(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function b(f,g){for(var e=[];g>0;e[--g]=f){}return e.join("")}var c=function(){if(!c.cache.hasOwnProperty(arguments[0])){c.cache[arguments[0]]=c.parse(arguments[0])}return c.format.call(null,c.cache[arguments[0]],arguments)};c.format=function(n,m){var r=1,p=n.length,h="",s,e=[],j,g,l,f,o,q;for(j=0;j<p;j++){h=a(n[j]);if(h==="string"){e.push(n[j])}else{if(h==="array"){l=n[j];if(l[2]){s=m[r];for(g=0;g<l[2].length;g++){if(!s.hasOwnProperty(l[2][g])){throw (sprintf('[sprintf] property "%s" does not exist',l[2][g]))}s=s[l[2][g]]}}else{if(l[1]){s=m[l[1]]}else{s=m[r++]}}if(/[^s]/.test(l[8])&&(a(s)!="number")){throw (sprintf("[sprintf] expecting number but found %s",a(s)))}switch(l[8]){case"b":s=s.toString(2);break;case"c":s=String.fromCharCode(s);break;case"d":s=parseInt(s,10);break;case"e":s=l[7]?s.toExponential(l[7]):s.toExponential();break;case"f":s=l[7]?parseFloat(s).toFixed(l[7]):parseFloat(s);break;case"o":s=s.toString(8);break;case"s":s=((s=String(s))&&l[7]?s.substring(0,l[7]):s);break;case"u":s=Math.abs(s);break;case"x":s=s.toString(16);break;case"X":s=s.toString(16).toUpperCase();break}s=(/[def]/.test(l[8])&&l[3]&&s>=0?"+"+s:s);o=l[4]?l[4]=="0"?"0":l[4].charAt(1):" ";q=l[6]-String(s).length;f=l[6]?b(o,q):"";e.push(l[5]?s+f:f+s)}}}return e.join("")};c.cache={};c.parse=function(e){var h=e,i=[],k=[],j=0;while(h){if((i=/^[^\x25]+/.exec(h))!==null){k.push(i[0])}else{if((i=/^\x25{2}/.exec(h))!==null){k.push("%")}else{if((i=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(h))!==null){if(i[2]){j|=1;var l=[],g=i[2],f=[];if((f=/^([a-z_][a-z_\d]*)/i.exec(g))!==null){l.push(f[1]);while((g=g.substring(f[0].length))!==""){if((f=/^\.([a-z_][a-z_\d]*)/i.exec(g))!==null){l.push(f[1])}else{if((f=/^\[(\d+)\]/.exec(g))!==null){l.push(f[1])}else{throw ("[sprintf] huh?")}}}}else{throw ("[sprintf] huh?")}i[2]=l}else{j|=2}if(j===3){throw ("[sprintf] mixing positional and named placeholders is not (yet) supported")}k.push(i)}else{throw ("[sprintf] huh?")}}}h=h.substring(i[0].length)}return k};return c})();var vsprintf=function(b,a){a.unshift(b);return sprintf.apply(null,a)}}if(!window.hasOwnProperty("HkToolkitCreateClasses")){window.HkToolkitCreateClasses=function(){try{if(!window.hasOwnProperty("Hk")){window.Hk=new Class({idScript:"HkToolkit",version:"2012.01.27.19.51.05",Coords:{lastRegion:{x:0,y:0},lastGoto:{x:0,y:0},regExp:/\(?\s*([0-9]+)\s*[,.\-]\s*([0-9]+)\s*\)?/},doNothing:Class.empty,initialize:function(){try{this.HOMMK=window.HOMMK;this.Player=this.HOMMK.player;this.PlayerId=this.Player.get("id");this.UserId=this.Player.get("userId");this.AllianceId=this.Player.get("allianceId");this.AllianceName=this.Player.get("allianceName");this.Map=this.HOMMK.worldMap;this.WorldSize=this.Map.get("_size");this.WorldId=this.Player.get("worldId")}catch(j){window.console.log("[Hk][ERROR]Hk-Initialisierung fehlgeschlagen: "+j)}},getRegionName:function c(j,n){if(arguments.length==1){var l=this.HOMMK.getXYFromRegionNumber();j=l.x;n=l.y}var k=window.HOMMK.getRegionFromXY(j,n);var m="";if(k.content.hasOwnProperty("cN")){m+=k.content.cN;if(k.content.hasOwnProperty("pN")&&!!k.content.pN){m+=", "+k.content.pN}if(k.content.hasOwnProperty("iAN")&&!!k.content.iAN){m+=" ("+k.content.iAN+")"}}else{if(k.content.hasOwnProperty("rB")){m+=k.content.rB.n;if(k.content.rB.hasOwnProperty("owner")&&!!k.content.rB.owner){m+="("+k.content.rB.owner.name+")"}}else{m+="Region #"+window.HOMMK.getRegionNumberFromXY(j,n)}}return m},fixPosition:function e(j){if(j>this.WorldSize){return j-this.WorldSize}return j},validatePosition:function b(j){j=new Number(j).round();if(isNaN(j)||j<=0||j>this.WorldSize){return false}return j},gotoPosition:function i(j,m,k){var l;if(!$defined(k)||!HOMMK.REGION_ZOOM_LIST.contains(k)){k=window.HOMMK.REGION_WORLDMAP_ZOOM_13X13}l=window.HOMMK.getRegionNumberFromXY(j,m);if(!this.validatePosition(j)||!this.validatePosition(m)){return false}window.HOMMK.setCurrentView(k,l,j,m);return true},getCurrentX:function h(){return this.validatePosition(this.Coords.lastRegion.x||window.HOMMK.currentView.regionX)},getCurrentY:function g(){return this.validatePosition(this.Coords.lastRegion.y||window.HOMMK.currentView.regionY)}})}}catch(f){window.console.log("[Hk][ERROR]"+f)}var a=function(){window.console.log("[PUBLIC][DEBUG]Starte HkToolkit\u2026");try{if(!window.hasOwnProperty("hkToolkit")){window.hkToolkit=new window.Hk()}if(!window.hasOwnProperty("hk")){window.hk=window.hkToolkit}}catch(j){window.console.log("[HkToolkit][ERROR]"+j)}window.HOMMK_HkToolkit=window.HOMMK_HkToolkit?window.HOMMK_HkToolkit:{version:window.hk.version}};return a};window.HkToolkitDependentObjectsAvailable=function(){return !!(window.HOMMK&&window.HOMMK.worldMap)}}window.console.log("[HkToolkit][PUBLIC]Erzeuge HkToolkit-Loader-Objekt\u2026");if(!window.hasOwnProperty("HkToolkitLoader")){window.HkToolkitLoader={loaded:false,load:function load(){if(window.HkToolkitLoader.loaded){window.console.log("[HkToolkitLoader][DEBUG]HkToolkit geladen\u2026");try{window.HkToolkitLoaderActive=$clear(window.HkToolkitLoaderActive)}catch(b){window.console.log("[HkToolkitLoader][Error]Fehler beim Beenden des Loaders: "+b)}return}window.console.log("[HkToolkitLoader][DEBUG]Warte auf Objekte\u2026");if(!!(window.HOMMK&&window.HOMMK.worldMap&&window.HkToolkitCreateClasses&&window.HkToolkitDependentObjectsAvailable&&window.HkToolkitDependentObjectsAvailable())){window.console.log("[HkToolkitLoader][DEBUG]Objekte verfügbar, bereite HkToolkit vor\u2026");try{window.HkToolkitLoader.loaded=true;var a=window.HkToolkitCreateClasses();a()}catch(b){window.console.log("[HkToolkitLoader][ERROR]Fehler beim Erzeugen der Klassen für HkToolkit: "+b)}}else{window.console.log("[HkToolkitLoader][DEBUG]HkToolkit wartet auf die Verfügbarkeit von Objekten.")}}}}window.console.log("[HkToolkit][PUBLIC]Starte HkToolkit-Loader\u2026");try{if(!window.hasOwnProperty("HkToolkitLoaderActive")){window.HkToolkitLoaderActive=window.HkToolkitLoader.load.periodical(5000)}}catch(ex){window.console.log("[HkToolkit][DEBUG]Fehler beim Laden von HkToolkit: "+ex)}if(!window.hasOwnProperty("HkStore")){window.HkStore={}}if(!window.hasOwnProperty("HkStorageCreateClasses")){window.HkStorageCreateClasses=function(){try{if(window.hasOwnProperty("Hk")&&!window.Hk.hasOwnProperty("HkStorage")){window.Hk.HkStorage=new Class({$debug:1,storageKey:"HkStorage"+window.hk.PlayerId+""+window.hk.WorldId,options:{storageKey:"HkStorage"+window.hk.PlayerId+""+window.hk.WorldId,clearStorage:false},initialize:function(l){try{window.console.log("[HkPublic][DEBUG]Bereite HkStorage vor\u2026");this.setOptions(l);this.storageKey=this.options.storageKey;window.console.log("[HkPublic][DEBUG]Initialisiere HkStorage #"+this.storageKey);if(this.options.clearStorage){this.clearStorage()}if(this.isEmpty()){window.console.log("[HkStorage][DEBUG]Erzeuge lokalen Speicher für #"+this.storageKey);this.setStorageData({})}}catch(m){window.console.log("[HkStorage][ERROR]Initialisierungsfehler: "+m)}},drop:function b(l){window.console.log("[HkStorage][DEBUG]Entferne "+l+" aus "+this.storageKey);var m=this.getStorageData();if($defined(m.key)||m.hasOwnProperty(l)){var n=m[l];delete m[l];this.setStorageData(m);return n}else{window.console.log("[HkStorage][INFO]Kein Eintrag "+l+" in "+this.storageKey)}return false},dropAll:function a(){var l=this.pull();window.console.log("[HkStorage][DEBUG]Entferne Daten aus "+this.storageKey);if(l){$each(l,function(n,m){window.console.log("[HkStorage][DEBUG]Verarbeite "+m);this.drop(m)}.bind(this))}},push:function h(l,m){if(arguments.length<2){window.console.log("[HkStorage][DEBUG]Speichere Daten: "+Json.toString(l))}else{window.console.log("[HkStorage][DEBUG]Speichere Daten unter #"+l+": "+Json.toString(m))}var n=this.getStorageData();if(arguments.length<2){$each(l,function(p,o){n[o]=p})}else{n[l]=m}this.setStorageData(n)},pull:function j(l){var n=this.getStorageData();if("null"==typeof n){window.console.log("[HkStorage.pull][DEBUG]null-Datentyp im Speicher");n={}}else{window.console.log("[HkStorage.pull][DEBUG]Datentyp im Speicher: "+typeof n)}if(!l){window.console.log("[HkStorage][DEBUG]Kein Schlüssel angefragt, liefere alle Daten zurück: "+Json.toString(l));var o={};for(d in n){window.console.log("[HkStorage][DEBUG]Prüfe Eintrag: "+Json.toString(d));if("function"==$type(n[d])){continue}window.console.log("[HkStorage][DEBUG]Eintrag akzeptiert.");o[d]=n[d]}return o}if(!n.hasOwnProperty(l)){return{}}var m=n[l];return m},isEmpty:function e(l){var m=$H(this.getStorageData()).keys();if(m==null||m.length<=0){window.console.log("[HkStorage][DEBUG]Keine Daten in #"+this.storageKey+": "+Json.toString(m));return true}return false},getStorageData:function c(){var l=window.localStorage.getItem(this.storageKey);window.console.log("[HkStorage][DEBUG]Abgerufene Daten aus #"+this.storageKey+": "+Json.toString(l));if(null==typeof l||!l){return{}}l=Json.evaluate(l);return l},setStorageData:function k(m){var l=Json.toString(m);window.console.log("[HkStorage][DEBUG]Speichere Daten in #"+this.storageKey+": "+l);window.localStorage.setItem(this.storageKey,l);this.fireEvent("onStorageUpdate",m);return m},clearStorage:function f(){window.console.log("[HkStorage][DEBUG]Leere Speicher...");window.localStorage.clear();this.fireEvent("onStorageUpdate",{})}});window.Hk.HkStorage.implement(new Events,new Options)}}catch(g){window.console.log("[HkStorage][ERROR]"+g)}var i=function(){try{if(!window.hk.hasOwnProperty("Storage")){window.hk.Storage={Common:new window.Hk.HkStorage()}}}catch(l){window.console.log("[HkStorage.Common][ERROR]"+l)}};return i};window.HkStorageDependentObjectsAvailable=function(){return !!(window.Hk&&window.hk)}}window.console.log("[HkStorage][PUBLIC]Erzeuge HkStorage-Loader-Objekt\u2026");if(!window.hasOwnProperty("HkStorageLoader")){window.HkStorageLoader={loaded:false,load:function load(){if(window.HkStorageLoader.loaded){window.console.log("[HkStorageLoader][DEBUG]HkStorage geladen\u2026");try{window.HkStorageLoaderActive=$clear(window.HkStorageLoaderActive)}catch(b){window.console.log("[HkStorageLoader][Error]Fehler beim Beenden des Loaders: "+b)}return}window.console.log("[HkStorageLoader][DEBUG]Warte auf Objekte\u2026");if(!!(window.HOMMK&&window.HOMMK.worldMap&&window.HkStorageCreateClasses&&window.HkStorageDependentObjectsAvailable&&window.HkStorageDependentObjectsAvailable())){window.console.log("[HkStorageLoader][DEBUG]Objekte verfügbar, bereite HkStorage vor\u2026");try{window.HkStorageLoader.loaded=true;var a=window.HkStorageCreateClasses();a()}catch(b){window.console.log("[HkStorageLoader][ERROR]Fehler beim Erzeugen der Klassen für HkStorage: "+b)}}else{window.console.log("[HkStorageLoader][DEBUG]HkStorage wartet auf die Verfügbarkeit von Objekten.")}}}}window.console.log("[HkStorage][PUBLIC]Starte HkStorage-Loader\u2026");try{if(!window.hasOwnProperty("HkStorageLoaderActive")){window.HkStorageLoaderActive=window.HkStorageLoader.load.periodical(5000)}}catch(ex){window.console.log("[HkStorage][DEBUG]Fehler beim Laden von HkStorage: "+ex)}if(!window.hasOwnProperty("HkReducerCreateClasses")){window.HkReducerCreateClasses=function(){if(!Hk.hasOwnProperty("HkReducer")){Hk.HkReducer=new Class({$debug:1,$status:null,$default:"TargetVisible",IS_REDUCED:"TargetReduced",IS_VISIBLE:"TargetVisible",options:{duration:500},initialize:function(f,h,g){this.setOptions(g);this.toggle=f;this.target=h;var i=this.options;i.onChange=function(j){window.console.log("[HkReducer][Event]Slider Change Event");window.console.log(j);this.fireEvent("onTargetChange",[this.toggle,this.target])}.bind(this);i.onTick=function(j){window.console.log("[HkReducer][Event]Slider Tick Event");window.console.log(j);this.fireEvent("onTargetStep",[this.toggle,this.target])}.bind(this);i.onComplete=function(j){window.console.log("[HkReducer][Event]Slider Complete Event");window.console.log(j);this.$status=(this.$status==this.IS_REDUCED)?this.IS_VISIBLE:this.IS_REDUCED;this.fireEvent("on"+this.$status,[this.toggle,this.target]);this.updateDimensions(this.target);this.fireEvent("onTargetComplete",[this.toggle,this.target])}.bind(this);this.toggle.slider=new Fx.Slide(this.target,i);this.toggle.target=this.target;this.toggle.reducer=this;this.target.reducer=this;this.toggle.addEvent("mousedown",this.togglePressed.bind(this));this.toggle.addEvent("click",this.toggleClicked.bind(this));if(this.$status==null){this.$status=this.$default}window.console.log(this.toggle.slider);this.updateDimensions(this.target)},togglePressed:function c(g){var f=g.target;var i=f.target;var h=f.slider;if(this.$status==this.IS_VISIBLE){window.console.log("[HkReducer][Event]Target height: "+i.style.height)}else{window.console.log("[HkReducer][Event]Target height: "+i.style.height)}},toggleClicked:function b(g){var f=g.target;var i=f.target;var h=f.slider;if(this.$status==this.IS_VISIBLE){h.slideOut()}else{h.slideIn()}},updateDimensions:function e(k){window.console.log("[HkReducer][DEBUG]Passe die Größen für "+k+" an\u2026");var i=k.getElementsByTagName("div");$each(i,function(n){var o=$(n).getStyle("height");var m=n.id||"N/A";if($chk(o)&&o.toInt()<=0&&o!="auto"){n.setStyle("height","auto")}});var g=k.id||"N/A";var f=$(k).getStyle("height");k.setStyle("height","auto");var j=$(k).getParent();if($defined(j)){var h=j.getStyle("height");var l=j.getCoordinates().height+"px";window.console.log("[HkReducer][DEBUG]Setze Höhe des Slide-Elements: "+h+" \u2192 "+l+"\u2026");j.setStyle("height",l)}}});Hk.HkReducer.implement(new Events,new Options)}var a=function(){};return a};window.HkReducerDependentObjectsAvailable=function(){return !!(window.Hk&&window.hk&&window.Hk.HkStorage&&window.hk.Storage)}}window.console.log("[HkReducer][PUBLIC]Erzeuge HkReducer-Loader-Objekt\u2026");if(!window.hasOwnProperty("HkReducerLoader")){window.HkReducerLoader={loaded:false,load:function load(){if(window.HkReducerLoader.loaded){window.console.log("[HkReducerLoader][DEBUG]HkReducer geladen\u2026");try{window.HkReducerLoaderActive=$clear(window.HkReducerLoaderActive)}catch(b){window.console.log("[HkReducerLoader][Error]Fehler beim Beenden des Loaders: "+b)}return}window.console.log("[HkReducerLoader][DEBUG]Warte auf Objekte\u2026");if(!!(window.HOMMK&&window.HOMMK.worldMap&&window.HkReducerCreateClasses&&window.HkReducerDependentObjectsAvailable&&window.HkReducerDependentObjectsAvailable())){window.console.log("[HkReducerLoader][DEBUG]Objekte verfügbar, bereite HkReducer vor\u2026");try{window.HkReducerLoader.loaded=true;var a=window.HkReducerCreateClasses();a()}catch(b){window.console.log("[HkReducerLoader][ERROR]Fehler beim Erzeugen der Klassen für HkReducer: "+b)}}else{window.console.log("[HkReducerLoader][DEBUG]HkReducer wartet auf die Verfügbarkeit von Objekten.")}}}}window.console.log("[HkReducer][PUBLIC]Starte HkReducer-Loader\u2026");try{if(!window.hasOwnProperty("HkReducerLoaderActive")){window.HkReducerLoaderActive=window.HkReducerLoader.load.periodical(5000)}}catch(ex){window.console.log("[HkReducer][DEBUG]Fehler beim Laden von HkReducer: "+ex)}if(!window.hasOwnProperty("HkWindowsCreateClasses")){window.HkWindowsCreateClasses=function(){var k=window.Hk;var h=window.hk;if(h.hasOwnProperty("Storage")&&!h.Storage.hasOwnProperty("HkWindows")){h.Storage.HkWindows=new k.HkStorage({storageKey:"HkWindowsInternal"})}if(!k.hasOwnProperty("HkWindows")){k.HkWindows=new Class({$debug:1,storage:window.hk.Storage.HkWindows,windows:[],options:{id:"HkWindow",reduceable:true,closeable:false,draggable:true,resizeable:true,scrollable:true,autoScroll:true,title:"HkWindow",createHeader:true,createTitle:true,showVersion:true,createContentContainer:true,createDonateButton:false,preventTextSelection:true,addToDOM:true,handleFocus:true,reduce:false,updateable:true,updateUrl:"${hk.hkwindows.update.testing}",scroller:false,scrollers:{up:Class.empty,down:Class.empty},windowStyles:window.HkStylesExtra.window,footerStyles:window.HkStylesExtra.footer,donateStyles:window.HkStylesExtra.donate,scrollAreaStyles:window.HkStylesExtra.scrollArea,scrollButtonStyles:window.HkStylesExtra.scrollButton,resizeButtonStyles:window.HkStylesExtra.resizeButton,headerStyles:window.HkStylesExtra.header,titleStyles:window.HkStylesExtra.title,reduceButtonStyles:window.HkStylesExtra.reduceButton,closeButtonStyles:window.HkStylesExtra.closeButton,updateButtonStyles:window.HkStylesExtra.updateButton,updateLinkStyles:window.HkStylesExtra.updateLink,contentStyles:window.HkStylesExtra.content,},initialize:function(J){this.setOptions(J);this.options.scrollers.up=this.scrollUp;this.options.scrollers.down=this.scrollDown},createWindow:function g(K,R){this.setOptions(R);var P=this.getWindowId(K,R);var J=new Element("div",{id:P,"class":"HkWindow Radius5BottomLeft Radius10TopLeft Radius10TopRight",styles:this.options.windowStyles});var M;if(this.options.createContentContainer){M=this.createContentContainer(K,R)}else{M=new Object}if(this.options.createHeader){var Q=this.createHeader(K,R);J.adopt(Q);if(this.options.draggable){new Drag.Move(J,{handle:Q,hkWindow:this,hkWindowId:K,onComplete:function(S){window.console.log("[HkWindow][DEBUG]Drag Complete Event an "+this.options.hkWindowId);if(!this.options.hkWindow.saveWindowPosition(this.options.hkWindowId,this.options.hkWindow.options)){window.console.log("[HkWindow][DEBUG]Drag Event Handler saveWindowPosition fehlgeschlagen für "+J.hkWindowId)}}})}}if(this.options.createContentContainer){J.adopt(M)}var O=this.createFooter(K,R);if(this.options.resizeable){window.console.log("[HkWindow][DEBUG]Erzeuge Resize-Button für "+K);var N=this.createResizeButton(K,R);O.adopt(N)}if(this.options.scrollable&&!this.options.autoScroll){var L=this.createScrollArea(K,R);O.adopt(L)}J.adopt(O);if(this.options.addToDOM){$("MainContainer").adopt(J);if(this.options.resizeable){this.makeResizeable(K,R,M)}this.windows.push(J)}this.loadWindowPosition(K,R);this.setFocusHandler(J);return J},setFocusHandler:function B(J){if(this.options.handleFocus){$$(J).addEvent("mouseenter",function(K){window.console.log("[HkWindows][DEBUG]mouseenter:");window.console.log(K);K.target.setStyle("zIndex",95000+500);$("MainContainer").getElements(".HkWindow[id!="+K.target.id+"]").setStyle("zIndex",95000-1)}).addEvent("mouseleave",function(K){window.console.log("[HkWindows][DEBUG]mouseleave:");window.console.log(K);K.target.setStyle("zIndex",95000);if(K.relatedTarget.hasClass("HkWindow")){K.relatedTarget.setStyle("zIndex",95000+500)}})}},getWindowNode:function E(L,J){window.console.log("[HkWindow][DEBUG]Rufe Fenster-Knoten für "+L);var K=$(this.getWindowId(L,J));return"undefined"==typeof K?null:K},getWindowPosition:function x(M,J){var K=this.getWindowNode(M,J);if(K==null){return null}var L=K.getPosition();window.console.log("[HkWindow][DEBUG]Abgerufene Fensterposition für  "+K.id+": "+Json.toString(L));return L},setWindowPosition:function j(N,M,J){var L=this.getWindowNode(M,J);if(L==null){return null}window.console.log("[HkWindow][DEBUG]Setze Fensterposition für  "+L.id+": "+Json.toString(N));if("undefined"==typeof N||!N||!("x" in N)||!("y" in N)){return null}var K={top:N.y,left:N.x};L.setStyles(K);return K},loadWindowPosition:function f(N,J){var L=this.getWindowNode(N,J);if(L==null){return null}var K="WindowPosition"+L.id;var M=this.storage.pull(K);window.console.log("[HkWindow][DEBUG]Geladene Fensterposition für  "+K+": "+Json.toString(M));if("undefined"==typeof M||!M||!("x" in M)||!("y" in M)){M=this.saveWindowPosition(N,J)}this.setWindowPosition(M,N,J);return M},saveWindowPosition:function z(N,J){var L;if((L=this.getWindowNode(N,J))==null){return null}var K="WindowPosition"+L.id;var M=this.getWindowPosition(N,J);window.console.log("[HkWindow][DEBUG]Speichere Fensterposition für  "+K+": "+Json.toString(M));this.storage.push(K,M);return M},showScrollButtons:function e(K,J){},hideScrollButtons:function G(K,J){},createFooter:function m(N,L){this.setOptions(L);var M=this.getId("HkWindowFooter",N,L);var J=new Element("div",{id:M,"class":"Radius5BottomLeft",styles:this.options.footerStyles});if(this.options.createDonateButton){var K=new Element("form",{action:"https://www.paypal.com/cgi-bin/webscr",method:"post","class":"above1000",target:"_blank",alt:"Unterstütze den Entwickler!",title:"Unterstütze den Entwickler!",name:"Unterstütze den Entwickler!",styles:this.options.donateStyles});K.innerHTML='<input type="hidden" name="cmd" value="_s-xclick"><input type="hidden" name="hosted_button_id" value="WRWUH9K7JBMBY"><input type="image" src="http://icons.iconarchive.com/icons/visualpharm/magnets/16/coins-icon.png" border="0" name="submit" title="Den Entwickler unterstützen!" name="Den Entwickler unterstützen!" alt="Den Entwickler unterstützen!"><img alt="" border="0" src="https://www.paypalobjects.com/de_DE/i/scr/pixel.gif" width="1" height="1">';J.adopt(K)}return J},createScrollArea:function F(M,J){this.setOptions(J);var K=this.getId("HkWindowScrollers",M,J);var L=new Element("div",{id:K,styles:this.options.scrollAreaStyles});$each(this.options.scrollers,function(P,N){var O=this.createScrollButton(M,J,N,P);L.adopt(O)}.bind(this));return L},createScrollButton:function C(O,J,M,K){this.setOptions(J);if(M!="up"&&M!="down"){M="down"}var N=this.getId("HkWindowScroll"+M,O,J);var L=new Element("img",{id:N,"class":"above1000",src:"http://icons.iconarchive.com/icons/saki/nuoveXT/16/Small-arrow-"+M+"-icon.png",styles:this.options.scrollButtonStyles});L.dir=M;L.srcId=O;L.btnId=N;L.btnOpts=J;L.btnWindow=this;L.addEvent("click",K.bind(this));return L},scrollUp:function q(L){window.console.log("[HkWindow][DEBUG]scrollUp:");var N=L.target.btnWindow.getWindowId(L.target.srcId,L.target.btnOpts);window.console.log("[HkWindow][DEBUG]Fenster-ID: "+N);var K=$(N).getElement(".HkContent");window.console.log(K.getSize());var M=K.getSize().size;var J=K.getSize().scroll;var O=K.getSize().scrollSize;var P=J.y-20<0?0:J.y-20;window.console.log("[HkWindow][DEBUG]Scrolle zu Y="+P);K.scrollTo(J.x,P);window.console.log(K.getSize())},scrollDown:function I(L){window.console.log("[HkWindow][DEBUG]scrollDown:");var N=L.target.btnWindow.getWindowId(L.target.srcId,L.target.btnOpts);window.console.log("[HkWindow][DEBUG]Fenster-ID: "+N);var K=$(N).getElement(".HkContent");window.console.log(K.getSize());var M=K.getSize().size;var J=K.getSize().scroll;var O=K.getSize().scrollSize;var P=J.y+M.y+20>O.y?O.y-M.y:J.y+20;window.console.log("[HkWindow][DEBUG]Scrolle zu Y="+P);K.scrollTo(J.x,P);window.console.log(K.getSize())},getId:function t(K,L,J){return K+$pick($pick(L,this.options.id),this.id)},getWindowId:function o(K,J){return this.getId("HkWindow",K,J)},createHeader:function s(P,M){this.setOptions(M);var N=this.getId("HkWindowHeader",P,M);var K=new Element("div",{id:N,"class":"HkWindowHeader GradientGreyDarkgreyGrey Radius10TopLeft Radius10TopRight",styles:this.options.headerStyles});if(this.options.reduceable){var J=this.createReduceButton(P,M);K.adopt(J)}if(this.options.updateable){var L=this.createUpdateButton(P,M);K.adopt(L)}if(this.options.createTitle){var O=this.createTitle(P,M);K.adopt(O)}return K},createTitle:function n(N,J){this.setOptions(J);var L=this.getId("HkWindowTitle",N,J);var M=new Element("h1",{id:L,"class":"HkWindowTitle Radius10TopLeft Radius10TopRight",styles:this.options.titleStyles});var K=this.options.title;if(this.options.showVersion){K+=" v.2012.01.27.19.51.05"}M.setText(K);M.hkBaseId=N;M.hkOptions=J;if(this.options.preventTextSelection){M.preventTextSelection()}if(this.options.draggable){this.HkMover=new Drag.Move($(this.getWindowId(N,J)),{handle:M,hkBaseId:N,hkOptions:J});M.setStyles({cursor:"move"})}return M},createUpdateButton:function b(M,L){this.setOptions(L);var J=new Element("a",{"class":"HkButton above1000",href:this.options.updateUrl,target:"_blank",styles:this.options.updateLinkStyles});var K=new Element("img",{"class":"above1000",alt:"Erzwinge Aktualisierung",title:"Erzwinge Aktualisierung",name:"Erzwinge Aktualisierung",src:"http://icons.iconarchive.com/icons/saki/snowish/16/Apps-system-software-update-icon.png",styles:this.options.updateButtonStyles});J.adopt(K);if(this.options.preventTextSelection){J.preventTextSelection()}return J},createCloseButton:function u(L,K){this.setOptions(K);var J=new Element("div",{"class":"HkClose HkButton above250",styles:this.options.closeButtonStyles});J.hkBaseId=L;J.hkOptions=K;return J},createContentContainer:function D(M,K){this.setOptions(K);var L=this.getId("HkWindowContent",M,K);var J=new Element("div",{id:L,"class":"HkContent",styles:this.options.contentStyles});if(this.options.preventTextSelection){J.preventTextSelection()}J.hkBaseId=M;J.hkOptions=K;return J},makeScrollable:function y(M,K){this.setOptions(K);if(!this.options.scroll||!this.options.autoScroll){return}var J=$(this.options.scroll);var L=this.getWindowId(M,K);$(L).autoScroller=new Scroller(J);return $(L).autoScroller},createReduceButton:function w(L,K){this.setOptions(K);var J=new Element("div",{"class":"HkReduce HkButton above1500",title:"Einrollen",name:"Einrollen",styles:this.options.reduceButtonStyles});J.setOpacity("0.8");if(this.options.preventTextSelection){J.preventTextSelection()}return J},makeReduceable:function r(N,L){this.setOptions(L);if(!this.options.reduce){return}var M=$(this.options.reduce);var K=$(this.getWindowId(N)).getElementsByTagName("div");var J=false;$each(K,function(O){O=$(O);if(O.hasClass("HkReduce")){J=O}});if(J&&M){this.HkReducer=new k.HkReducer(J,M,{hkWindowId:N,hkReduceButton:J,hkReduce:M});this.HkReducer.addEvent("onTargetComplete",this.reduceCompleted.bind(this))}},reduceCompleted:function c(J,K){window.console.log("[HkWindows][DEBUG]reduceCompleted:");window.console.log(J);window.console.log(K)},createResizeButton:function H(M,J){var L=this.getId("HkWindowResize",M,J);var K=new Element("div",{id:L,"class":"HkWindowResizeButton above1500",styles:this.options.resizeButtonStyles});if(this.options.preventTextSelection){K.preventTextSelection()}return K},makeResizeable:function v(M,K,J){this.setOptions(K);if(!this.options.resizeable){return}var L=this.getId("HkWindowResize",M,K);J=$(($defined(J)?J:this.getId("HkWindow",M,K)));this.resizeElement=$(J);window.console.log("[HkWindow][DEBUG]Erzeuge Resizeable-Funktion via "+L);this.resizeElement.HkResizer=new Drag.Base(J,{handle:$(L),hkResize:$(J),hkWindow:this,hkWindowId:M,hkWindowOptions:K,modifiers:{x:"width",y:"height"},onComplete:function(N){window.console.log("[HkWindow][Event]Resize Complete Event an "+this.options.hkWindowId);if(this.options.hkWindow.options.reduceable){window.console.log("[HkWindow][DEBUG]Löse Höhenfestlegung durch Reduceable für "+this.options.hkWindowId);var O=this.hkResize||N.getParent();if(O.getStyle("overflow")=="hidden"&&O.getStyle("height")!="auto"){O.setStyles({height:"auto",maxHeight:window.hkGetMaxHeight(1.25)})}}if(!this.options.hkWindow.saveWindowSize(this.options.hkWindowId,this.options.hkWindow.options)){window.console.log("[HkWindow][WARN]Resize Event Handler saveWindowSize fehlgeschlagen für "+this.options.hkWindowId)}this.options.hkWindow.resizeElement.fireEvent("onWindowResize",[N,N.getParent])}})},getWindowSize:function A(M,J){var L=this.resizeElement||this.getWindowNode(M,J);if(L==null){return null}var K=L.getSize();window.console.log("[HkWindow][DEBUG]Abgerufene Fenstergröße für  "+L.id+": "+Json.toString(K));return K},setWindowSize:function p(L,N,K){var M=this.resizeElement||this.getWindowNode(N,K);if(M==null){return null}window.console.log("[HkWindow][DEBUG]Setze Fenstergröße für  "+M.id+": "+Json.toString(L));if("undefined"==typeof L||!L||!("size" in L)||!("x" in L.size)||!("y" in L.size)){return null}var J={width:L.size.x,height:L.size.y};M.setStyles(J);return J},loadWindowSize:function l(N,J){var M=this.resizeElement||this.getWindowNode(N,J);if(M==null){return null}var L="WindowSize"+M.id;var K=this.storage.pull(L);window.console.log("[HkWindow][DEBUG]Geladene Fenstergröße für  "+L+": "+Json.toString(K));if("undefined"==typeof K||!K||!("size" in K)||!("x" in K.size)||!("y" in K.size)){K=this.saveWindowSize(N,J)}this.setWindowSize(K,N,J);return K},saveWindowSize:function a(N,J){var M=this.resizeElement||this.getWindowNode(N,J);if(M==null){return null}var L="WindowSize"+M.id;var K=this.getWindowSize(N,J);window.console.log("[HkWindow][DEBUG]Speichere Fenstergröße für  "+L+": "+Json.toString(K));this.storage.push(L,K);return K}});window.Hk.HkWindows.implement(new Events,new Options)}var i=function(){if(!window.hk.hasOwnProperty("Windows")){window.hk.Windows=new window.Hk.HkWindows()}};return i};window.HkWindowsDependentObjectsAvailable=function(){return !!(window.Hk&&window.hk&&window.Hk.HkReducer)}}window.console.log("[HkWindows][PUBLIC]Erzeuge HkWindows-Loader-Objekt\u2026");if(!window.hasOwnProperty("HkWindowsLoader")){window.HkWindowsLoader={loaded:false,load:function load(){if(window.HkWindowsLoader.loaded){window.console.log("[HkWindowsLoader][DEBUG]HkWindows geladen\u2026");try{window.HkWindowsLoaderActive=$clear(window.HkWindowsLoaderActive)}catch(b){window.console.log("[HkWindowsLoader][Error]Fehler beim Beenden des Loaders: "+b)}return}window.console.log("[HkWindowsLoader][DEBUG]Warte auf Objekte\u2026");if(!!(window.HOMMK&&window.HOMMK.worldMap&&window.HkWindowsCreateClasses&&window.HkWindowsDependentObjectsAvailable&&window.HkWindowsDependentObjectsAvailable())){window.console.log("[HkWindowsLoader][DEBUG]Objekte verfügbar, bereite HkWindows vor\u2026");try{window.HkWindowsLoader.loaded=true;var a=window.HkWindowsCreateClasses();a()}catch(b){window.console.log("[HkWindowsLoader][ERROR]Fehler beim Erzeugen der Klassen für HkWindows: "+b)}}else{window.console.log("[HkWindowsLoader][DEBUG]HkWindows wartet auf die Verfügbarkeit von Objekten.")}}}}window.console.log("[HkWindows][PUBLIC]Starte HkWindows-Loader\u2026");try{if(!window.hasOwnProperty("HkWindowsLoaderActive")){window.HkWindowsLoaderActive=window.HkWindowsLoader.load.periodical(5000)}}catch(ex){window.console.log("[HkWindows][DEBUG]Fehler beim Laden von HkWindows: "+ex)}window.$debug=window.$debug||1;if(!window.hasOwnProperty("HkExplorerCreateClasses")){window.HkExplorerCreateClasses=function(){var h=window.Hk;var c=window.hk;window.HOMMK_HkExplorer=window.HOMMK_HkExplorer?window.HOMMK_HkExplorer:{version:c.version};var o=c.HOMMK;var n=c.idScript;var f=c.version;window.console.log("[PUBLIC][DEBUG]Starte HkExplorer\u2026");h.HkRuinsData=[];h.HkRuins=new Class({initialize:function(){this.rA=[];this.xRA=[];for(var w=1;w<10;w++){window.console.log("[HkExplorer][DEBUG]XHR-Request #"+w);this.xRA.push(new Ajax("http://mightandmagicheroeskingdoms.ubi.com/ajaxRequest/ruinsRegionNumberAutocompletion?start="+w,{method:"get",evalResponse:true,onComplete:function(){window.console.log('[HkExplorer][DEBUG"]XHR Request komplett.')}}))}this.xG=new Group();this.xG.instances=this.xRA;this.xG.addEvent("onComplete",this.requestsComplete.bindAsEventListener(this));return this},start:function(){this.xRA.each(function(w,x){var y=x*500;w.request.delay(y,w)}.bind(this))},sort:function v(w,y){window.console.log("[HkExplorer][RUINS]Sortiere Ruinen...");if("undefined"==typeof w){w="n"}window.console.log("[HkExplorer][RUINS]Sortierschlüssel: "+w);if("undefined"==typeof y&&this.hasOwnProperty("rA")){window.console.log("[HkExplorer][RUINS]Benutze gespeicherte Daten...");y=this.rA.copy()}else{if("undefined"==typeof y){window.console.log("[HkExplorer][DEBUG]Keine Daten zum Sortieren vorhanden, Abbruch...");return[]}}var z=y.copy();window.console.log(z);var x=z.sort(function(B,A){var C=[B[w],A[w]];if(C.some(function(E,D){return E.toString().test("[a-z]","i")})){C=C.map(function(E,D){return E.toString().toLowerCase()}).reverse()}else{C=C.map(function(E,D){return E.toString().toInt()}).reverse()}if(C[0]==C[1]){return 0}return C[0]>C[1]?-1:1});window.console.log("[HkExplorer][DEBUG]Sortierte Daten: ");window.console.log(x);return x},extractRuins:function r(w,y){var x=JSON.parse(w);x.each(function(D){var C=D.getLast();var z=C.match(/([^\(]+)\(([^\)]+)\)(.*)/);if(z.length!=4){window.console.log("[HkExplorer][RUINS]Ruinen-Info passt nicht zum regulären Ausdruck:");window.console.log(z)}var B=String(z[2]).split(",");window.console.log("[HkExplorer][RUINS]Koordinaten:");window.console.log(B);if(B.length!=2){window.console.log("[HkExplorer][RUINS]Ruinentext passt nicht zum Schema:");window.console.log(B)}var A={n:stringPadLeft(z[1].trim(),5,"0"),x:B[0].trim(),y:B[1].trim(),a:z[3].trim(),xy:B[0].trim()+", "+B[1].trim()};window.console.log("[HkExplorer][DEBUG]Speichere Ruine:");window.console.log(A);this.push(A)}.bind(y));return y},requestsComplete:function s(){window.console.log("[HkExplorer][DEBUG]XHR-Anfragen für Ruinen komplett...");var w=[];this.xRA.each(function(x,y){if(!x.hasOwnProperty("response")||!x.response.hasOwnProperty("text")){window.console.log("[HkExplorer][WARN]Fehlerhafte Antwort bei Ruine #"+y);return}window.console.log("[HkExplorer][DEBUG]Extrahiere Ruine #"+y);window.console.log(x);w=this.extractRuins(x.response.text,w)}.bind(this));window.console.log("[HkExplorer][DEBUG]Gesammelte Ruinen:");window.console.log(w);this.rA=w;this.fireEvent("onComplete",[w,this],50)}});h.HkRuins.implement(new Events);h.HkExplorer=new Class({$hkWin:false,inputStyles:{valid:{border:"1px solid #030303"},error:{border:"1px solid #fa0c0c"}},initialize:function(w){this.setOptions(w);window.console.log("[HkExplorer][DEBUG]Initialisiere\u2026");try{this.$hkWin=window.hk.Windows.createWindow("HkExplorer",{title:"HkExplorer",updateable:true,updateUrl:"https://github.com/gelgamek/HOMMK-Toolkit/raw/STABLE/hommk_explorer.user.js"});window.console.log("[HkExplorer][DEBUG]Erzeuge Content\u2026");this.createContent(this.$hkWin)}catch(x){window.console.log("[HkExplorer][DEBUG]Fehler bei der Initialisierung: "+x)}},createAccordion:function m(w){window.console.log("[HkExplorer][DEBUG]Erzeuge Accordion: ");w.accordionMenu=new Fx.Accordion($$(".HkListCategory"),$$(".HkList"),{alwaysHide:false,show:false,display:1,opacity:false,height:true,returnHeightToAuto:false});w.accordionMenu.showThisHideOpen()},createContent:function i(x){var w=x.getElement(".HkContent");window.console.log("[HkExplorer][DEBUG]Content-Element: ");window.console.log(w);w.preventTextSelection();w.setStyle("paddingTop","0px");window.console.log("[HkExplorer][DEBUG]Initialisiere Content-Node: ");this.getHkRuins();this.createRuinSections();this.createCitiesSection();this.updateExplorer();this.createAccordion(w)},ruinsUpdated:function a(x,w){window.console.log("[HkExplorer][DEBUG]ruinsUpdated:");window.console.log($A(arguments));this.updateRuinSections(w)},getHkRuins:function g(){this.$hkRuins=new h.HkRuins();this.$hkRuins.addEvent("onComplete",this.ruinsUpdated.bindAsEventListener(this));this.$hkRuins.start()},updateExplorer:function e(){window.console.log("[HkExplorer][DEBUG]Explorer-Update...");this.updateCities()},getCities:function b(){window.console.log("[HkExplorer][DEBUG]Rufe Städte ab...");if($chk(window.hk.Map.content.attachedRegionList)){var w=window.hk.Map.content.attachedRegionList;var x=$A(w).filter(function(z,y){if(z&&"undefined"!=typeof z.contents){return z.contents.hasOwnProperty("cN")}return false});return x}},getRegions:function k(){window.console.log("[HkExplorer][DEBUG]Rufe Regionen ab...");if($chk(window.hk.Map.content.attachedRegionList)){var w=window.hk.Map.content.attachedRegionList;var x=$A(w).filter(function(z,y){if(z&&"undefined"!=typeof z.contents){return z.contents.hasOwnProperty("cN")}return false});return w}},createRuinSections:function q(){var w=[{key:"n",name:"RegionNumber",title:"nach Regionen"},{key:"a",name:"Alliance",title:"nach Bündnissen"}];window.console.log("[HkExplorer][DEBUG]Erzeuge Bereiche der Ruinen: ");w.each(function(x,D){window.console.log("[HkExplorer][DEBUG]Erzeuge Bereich der Ruinen: ");var F=$("HkWindowContentHkExplorer");window.console.log(F);var y="HkExplorerRuins"+x.name;var A="HkExplorerRuins"+x.name+"Category";var z="HkExplorerRuins"+x.name+"List";var C=new Element("div",{id:y,"class":"HkListContainer"});C.preventTextSelection();var G=new Element("div",{id:A,"class":"HkListCategory",styles:{cursor:"pointer"}});var B=new Element("p");B.setHTML("<strong>Ruinen "+x.title+"</strong>");B.preventTextSelection();B.injectInside(G);G.preventTextSelection();G.injectInside(C);var E=new Element("div",{id:z,"class":"HkList"});E.preventTextSelection();E.injectInside(C);C.injectInside(F);window.console.log("[HkExplorer][DEBUG]Erzeuge AutoScroller für Ruinen");G.autoScroller=new Scroller(E);G.autoScroller.start()})},updateRuinSections:function j(x){window.console.log("[HkExplorer][DEBUG]updateRuinSections:");window.console.log($A(arguments));var w=x||this.$hkRuins;var y=[{key:"n",name:"RegionNumber",displayOrder:["n","a","xy"],tableRow:"<td class='alignRight'>%(n)s</td><td class='alignCenter'> - </td><td class='alignLeft'>%(a)s</td><td class='alignCenter'> - </td><td class='alignRight'>%(x)s</td><td class='alignCenter'>,</td><td class='alignRight'>%(y)s</td>",rowFormat:"%(n)s - %(a)s - %(x)s,%(y)s"},{key:"a",name:"Alliance",displayOrder:["a","xy","n"],tableRow:"<td class='alignLeft'>%(a)s</td><td class='alignCenter'> - </td><td class='alignRight'>%(x)s</td><td class='alignCenter'>,</td><td class='alignRight'>%(y)s</td><td class='alignCenter'> - </td><td class='alignRight'>%(n)s</td>",rowFormat:"%(a)s - %(x)s,%(y)s - %(n)s"}];window.console.log("[HkExplorer][DEBUG]Aktualisiere Bereiche der Ruinen: ");window.console.log(w);y.each(function(F,D){var z=$("HkWindowContentHkExplorer");window.console.log("[HkExplorer][DEBUG]Update der Ruinenliste #"+D);window.console.log(F);var C="HkExplorerRuins"+F.name+"List";window.console.log("[HkExplorer][DEBUG]Leere die Ruinenliste "+C);$(C).getElements(".HkListEntry").remove();var B=F.key;window.console.log("[HkExplorer][DEBUG]Sortiere Daten für Ruinenliste nach "+B);window.console.log(w);var E=w.sort(B);window.console.log("[HkExplorer][DEBUG]Sortierte Daten für Ruinenliste nach "+B+":");window.console.log(E);window.console.log("[HkExplorer][DEBUG]Schreibe Daten in Ruinenliste...");var A=new Element("table");A.injectInside($(C));E.each(function(J,H){window.console.log("[HkExplorer][DEBUG]Erzeuge Eintrag #"+H);var I=new Element("tr",{"class":"HkListEntry",styles:{cursor:"pointer"}});window.console.log("[HkExplorer][DEBUG]Erzeuge Text für Eintrag #"+H);var K=sprintf(F.rowFormat,J);window.console.log("Verwende Text: "+K);var G=sprintf(F.tableRow,J);window.console.log("Test TableRow: "+G);I.innerHTML=G;I.preventTextSelection();I.injectInside(A);I.getElements("td").addEvent("click",function(L){window.console.log("[HkExplorer][DEBUG]Click Event an Ruineneintrag: ");window.hk.gotoPosition(J.x,J.y)})})});window.hkStylesGeneric.applyStyles()},createCitiesSection:function p(){var w=$("HkWindowContentHkExplorer");window.console.log("[HkExplorer][DEBUG]Erzeuge Bereich der Städte: ");window.console.log(w);var y=new Element("div",{id:"HkExplorerCities","class":"HkListContainer"});y.preventTextSelection();y.injectInside(w);var z=new Element("div",{id:"HkExplorerCitiesCategory","class":"HkListCategory",styles:{cursor:"pointer"}});z.innerHTML="<p><strong>Städte</strong></p>";z.injectInside(y);var x=new Element("div",{id:"HkExplorerCitiesList","class":"HkList"});x.preventTextSelection();x.injectInside(y);window.console.log("[HkExplorer][DEBUG]Erzeuge AutoScroller für Städte");z.autoScroller=new Scroller(x);z.autoScroller.start()},updateCities:function u(){var w=$("HkWindowContentHkExplorer");window.console.log("[HkExplorer][DEBUG]Update der Städteliste: ");window.console.log($("HkExplorerCitiesList"));$("HkExplorerCitiesList").getElements(".HkListEntry").remove();var x=this.getCities();if(x.length>0){x.each(function(A){window.console.log(A);var z=new Element("div",{"class":"HkListEntry"});var y=""+A.cN+" - "+A.pN+", "+A.iAN+"("+A.x+","+A.y+")";z.setHTML("<p class='HkListText'>"+y+"</p>");z.preventTextSelection();z.injectInside($("HkExplorerCitiesList"))})}window.console.log(x)},updateDimensions:function l(){var w=$$("HkWindowContentHkExplorer","HkWindowHkExplorer");w.setStyles({maxHeight:(parseInt(window.getHeight())/2)+"px"})}});h.HkExplorer.implement(new Events,new Options);var t=function(){try{window.console.log("[HkExplorer][DEBUG]Erzeuge HkExplorer-Fenster");window.hk.Explorer=new window.Hk.HkExplorer()}catch(w){window.console.log("[HkExplorer][ERROR]Fehler beim Erzeugen des HkExplorer-Fensters: "+w)}try{window.hk.Explorer.updateDimensions();window.hk.Windows.makeReduceable("HkExplorer",{reduce:$("HkWindowContentHkExplorer"),title:"HkExplorer"})}catch(w){window.console.log("[HkExplorer][ERROR]Fehler bei der Finalisierung des HkExplorer-Fensters: "+w)}try{window.hk.Windows.makeScrollable("HkExplorer",{scroll:$("HkWindowContentHkExplorer"),autoScroll:true}).start()}catch(w){window.console.log("[HkExplorer][ERROR]Fehler bei der Finalisierung des HkExplorer-Fensters: "+w)}if("undefined"==typeof window.hkStylesGeneric){try{window.hkStylesGeneric=new window.HkStylesGeneric()}catch(w){window.console.log("[HkExplorer][ERROR]Fehler bei der Finalisierung des HkExplorer-Fensters: "+w)}}window.hkStylesGeneric.applyStyles()};return t};window.HkExplorerDependentObjectsAvailable=function(){try{return window.Hk&&window.hk&&window.Hk.HkWindows&&window.hk.Windows}catch(a){return false}}}window.console.log("[HkExplorer][PUBLIC]Erzeuge HkExplorer-Loader-Objekt\u2026");if(!window.hasOwnProperty("HkExplorerLoader")){window.HkExplorerLoader={loaded:false,load:function load(){if(window.HkExplorerLoader.loaded){window.console.log("[HkExplorerLoader][DEBUG]HkExplorer geladen\u2026");try{window.HkExplorerLoaderActive=$clear(window.HkExplorerLoaderActive)}catch(b){window.console.log("[HkExplorerLoader][Error]Fehler beim Beenden des Loaders: "+b)}return}window.console.log("[HkExplorerLoader][DEBUG]Warte auf Objekte\u2026");if(!!(window.HOMMK&&window.HOMMK.worldMap&&window.HkExplorerCreateClasses&&window.HkExplorerDependentObjectsAvailable&&window.HkExplorerDependentObjectsAvailable())){window.console.log("[HkExplorerLoader][DEBUG]Objekte verfügbar, bereite HkExplorer vor\u2026");try{window.HkExplorerLoader.loaded=true;var a=window.HkExplorerCreateClasses();a()}catch(b){window.console.log("[HkExplorerLoader][ERROR]Fehler beim Erzeugen der Klassen für HkExplorer: "+b)}}else{window.console.log("[HkExplorerLoader][DEBUG]HkExplorer wartet auf die Verfügbarkeit von Objekten.")}}}}window.console.log("[HkExplorer][PUBLIC]Starte HkExplorer-Loader\u2026");try{if(!window.hasOwnProperty("HkExplorerLoaderActive")){window.HkExplorerLoaderActive=window.HkExplorerLoader.load.periodical(5000)}}catch(ex){window.console.log("[HkExplorer][DEBUG]Fehler beim Laden von HkExplorer: "+ex)};