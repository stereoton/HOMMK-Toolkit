// ==UserScript==
// @name HkShortcuts
// @version 2012.01.20.09.58.370000
// @description Shortcuts für HkToolkit :: Werkzeugkasten für MMHK/HOMMK
// @author Gelgamek <gelgamek@arcor.de>
// @copyright Gelgamek et al., Artistic License 2.0, http://www.opensource.org/licenses/Artistic-2.0
// @icon http://icons.iconarchive.com/icons/webiconset/mobile/32/maps-icon.png
// @namespace http://mightandmagicheroeskingdoms.ubi.com/play
// @match http://mightandmagicheroeskingdoms.ubi.com/play*
//
// Content Scope Runner:
// @require http://userscripts.org/scripts/source/68059.user.js
// ==/UserScript==

if('undefined' == typeof __PAGE_SCOPE_x_f53697f5_8d6b_49fa_88a3_5abf1912faa6_RUN__) { (function page_scope_runner() {
	// If we're _not_ already running in the page, grab the full source
	// of this script.
	var my_src = "(" + page_scope_runner.caller.toString() + ")();";
	
	// Create a script node holding this script, plus a marker that lets us
	// know we are running in the page scope (not the Greasemonkey sandbox).
	// Note that we are intentionally *not* scope-wrapping here.
	var script = document.createElement('script');
	script.setAttribute("type", "text/javascript");
	script.textContent = "var __PAGE_SCOPE_x_f53697f5_8d6b_49fa_88a3_5abf1912faa6_RUN__ = true;\n" + my_src;
	
	// Insert the script node into the page, so it will run, and immediately
	// remove it to clean up. Use setTimeout to force execution "outside" of
	// the user script scope completely.
	setTimeout(function() {
		document.body.appendChild(script);
		document.body.removeChild(script);
	}, 0);
})();return; }if(!window.localStorage){Object.defineProperty(window,"localStorage",new (function(){var a=[],b={};Object.defineProperty(b,"getItem",{value:function(c){return c?this[c]:null},writable:false,configurable:false,enumerable:false});Object.defineProperty(b,"key",{value:function(c){return a[c]},writable:false,configurable:false,enumerable:false});Object.defineProperty(b,"setItem",{value:function(c,e){if(!c){return}document.cookie=escape(c)+"="+escape(e)+"; path=/"},writable:false,configurable:false,enumerable:false});Object.defineProperty(b,"length",{get:function(){return a.length},configurable:false,enumerable:false});Object.defineProperty(b,"removeItem",{value:function(e){if(!e){return}var c=new Date();c.setDate(c.getDate()-1);document.cookie=escape(e)+"=; expires="+c.toGMTString()+"; path=/"},writable:false,configurable:false,enumerable:false});this.get=function(){var c;for(var g in b){c=a.indexOf(g);if(c===-1){b.setItem(g,b[g])}else{a.splice(c,1)}delete b[g]}for(a;a.length>0;a.splice(0,1)){b.removeItem(a[0])}for(var e,f,i=0,h=document.cookie.split(/\s*;\s*/);i<h.length;i++){e=h[i].split(/\s*=\s*/);if(e.length>1){b[f=unescape(e[0])]=unescape(e[1]);a.push(f)}}return b};this.configurable=false;this.enumerable=true})())}if("undefined"==typeof window.console){window.console={log:function log(a){return a}}}else{window.console.logNative=window.console.log;window.console.log=function(c,b){if("function"==typeof window.console.logNative){var a=("undefined"!=typeof window.$debug?window.$debug:(("undefined"!=typeof b)?b:0));if(a>=1){window.console.logNative(c)}if(a>1){alert(c)}}return c}}if("undefined"==typeof window.HkLogger){var HkLogger=new Class({log:function log(a){window.console.log(a)}});window.HkLogger=HkLogger}if("undefined"==typeof HkFinder){var HkFinder=new Class({getRecursive:function getRecursive(c,b){var e=this;var a=b;var f=c.split(".");if(!f.every(function(i,h,g){if(!e.hasOwnProperty(i)){return false}e=e.val;if(h+1>=g.length){a=e}return true},null)){return b}return a}})}try{if("undefined"==typeof window.console){window.console={log:function log(a){}}}}catch(ex){}if("undefined"==typeof window.HkStylesGeneric){window.HkStylesGeneric=new Class({initialize:function(){},applyStyles:function applyStyles(){$A(this.styles).each(function(b,a){var e,c=b;if(c.selector.indexOf(".")!=-1||c.selector.indexOf("#")!=-1){e=$$(c.selector)}else{e=$(c.selector.substr(1))}if(e){if("undefined"==typeof e.length){e=[e]}e=$A(e);e.each(function(g,f){window.console.log("Weise Stile zu\u2026");window.console.log(g);window.console.log(c.styles);$each(c.styles,function(h,i){window.console.log("Weise Wert '"+h+"' zu für Stil "+i);if(g.style[i]!=""&&!c.force){window.console.log("Wert existiert bereits, Zuweisung nicht erzwungen\u2026");return}else{window.console.log("Wert existiert bereits, Zuweisung erzwungen\u2026")}window.console.log("Alter Wert: "+g.style[i]);g.style[i]=h})})}})},styles:[{selector:".GradientGreyDarkgreyGrey",styles:{background:"linear-gradient(top, #202020, #040404 20%, #040404 40%, #303030)"}},{selector:".GradientGreyDarkgreyGrey",styles:{background:"-webkit-linear-gradient(top, #202020, #040404 20%, #040404 40%, #303030)"}},{selector:".GradientGreyDarkgreyGrey",styles:{background:"-moz-linear-gradient(top, #202020, #040404 20%, #040404 40%, #303030)"}},{force:true,selector:".Radius5",styles:{"border-radius":"5px"}},{force:true,selector:".Radius5BottomLeft",styles:{"border-bottom-left-radius":"5px"}},{force:true,selector:".Radius10",styles:{"border-radius":"10px"}},{force:true,selector:".Radius10TopLeft",styles:{"border-top-left-radius":"5px"}},{force:true,selector:".Radius10TopRight",styles:{"border-top-right-radius":"5px"}},{force:true,selector:".HkButton",styles:{border:"none"}}]});var HkStylesGeneric=window.HkStylesGeneric}else{window.console.log("[HkStylesGeneric][WARN]Klasse existiert bereits: "+Json.toString(window.HkStylesGeneric))}if("undefined"==typeof $E){function $E(a,b){return($(b)||document).getElement(a)}function $ES(a,b){return($(b)||document).getElementsBySelector(a)}$$.shared={regexp:/^(\w*|\*)(?:#([\w-]+)|\.([\w-]+))?(?:\[(\w+)(?:([!*^$]?=)["']?([^"'\]]*)["']?)?])?$/,xpath:{getParam:function(b,e,f,c){var a=[e.namespaceURI?"xhtml:":"",f[1]];if(f[2]){a.push('[@id="',f[2],'"]')}if(f[3]){a.push('[contains(concat(" ", @class, " "), " ',f[3],' ")]')}if(f[4]){if(f[5]&&f[6]){switch(f[5]){case"*=":a.push("[contains(@",f[4],', "',f[6],'")]');break;case"^=":a.push("[starts-with(@",f[4],', "',f[6],'")]');break;case"$=":a.push("[substring(@",f[4],", string-length(@",f[4],") - ",f[6].length,' + 1) = "',f[6],'"]');break;case"=":a.push("[@",f[4],'="',f[6],'"]');break;case"!=":a.push("[@",f[4],'!="',f[6],'"]')}}else{a.push("[@",f[4],"]")}}b.push(a.join(""));return b},getItems:function(b,f,h){var g=[];var a=document.evaluate(".//"+b.join("//"),f,$$.shared.resolver,XPathResult.UNORDERED_NODE_SNAPSHOT_TYPE,null);for(var e=0,c=a.snapshotLength;e<c;e++){g.push(a.snapshotItem(e))}return(h)?g:new Elements(g.map($))}},normal:{getParam:function(a,c,f,b){if(b==0){if(f[2]){var e=c.getElementById(f[2]);if(!e||((f[1]!="*")&&(Element.getTag(e)!=f[1]))){return false}a=[e]}else{a=$A(c.getElementsByTagName(f[1]))}}else{a=$$.shared.getElementsByTagName(a,f[1]);if(f[2]){a=Elements.filterById(a,f[2],true)}}if(f[3]){a=Elements.filterByClass(a,f[3],true)}if(f[4]){a=Elements.filterByAttribute(a,f[4],f[5],f[6],true)}return a},getItems:function(a,b,c){return(c)?a:$$.unique(a)}},resolver:function(a){return(a=="xhtml")?"http://www.w3.org/1999/xhtml":false},getElementsByTagName:function(e,c){var f=[];for(var b=0,a=e.length;b<a;b++){f.extend(e[b].getElementsByTagName(c))}return f}};$$.shared.method=(window.xpath)?"xpath":"normal";Element.Methods.Dom={getElements:function(a,k){var c=[];a=a.trim().split(" ");for(var f=0,e=a.length;f<e;f++){var g=a[f];var h=g.match($$.shared.regexp);if(!h){break}h[1]=h[1]||"*";var b=$$.shared[$$.shared.method].getParam(c,this,h,f);if(!b){break}c=b}return $$.shared[$$.shared.method].getItems(c,this,k)},getElement:function(a){return $(this.getElements(a,true)[0]||false)},getElementsBySelector:function(a,f){var e=[];a=a.split(",");for(var c=0,b=a.length;c<b;c++){e=e.concat(this.getElements(a[c],true))}return(f)?e:$$.unique(e)}};Element.extend({getElementById:function(c){var b=document.getElementById(c);if(!b){return false}for(var a=b.parentNode;a!=this;a=a.parentNode){if(!a){return false}}return b},getElementsByClassName:function(a){return this.getElements("."+a)}});document.extend(Element.Methods.Dom);Element.extend(Element.Methods.Dom)}if("undefined"==typeof Scroller){var Scroller=new Class({options:{area:20,velocity:1,onChange:function(a,b){this.element.scrollTo(a,b)}},initialize:function(b,a){this.setOptions(a);this.element=$(b);this.mousemover=([window,document].contains(b))?$(document.body):this.element},start:function(){this.coord=this.getCoords.bindWithEvent(this);this.mousemover.addListener("mousemove",this.coord)},stop:function(){this.mousemover.removeListener("mousemove",this.coord);this.timer=$clear(this.timer)},getCoords:function(a){this.page=(this.element==window)?a.client:a.page;if(!this.timer){this.timer=this.scroll.periodical(50,this)}},scroll:function(){var a=this.element.getSize();var e=this.element.getPosition();var c={x:0,y:0};for(var b in this.page){if(this.page[b]<(this.options.area+e[b])&&a.scroll[b]!=0){c[b]=(this.page[b]-this.options.area-e[b])*this.options.velocity}else{if(this.page[b]+this.options.area>(a.size[b]+e[b])&&a.scroll[b]+a.size[b]!=a.scrollSize[b]){c[b]=(this.page[b]-a.size[b]+this.options.area-e[b])*this.options.velocity}}}if(c.y||c.x){this.fireEvent("onChange",[a.scroll.x+c.x,a.scroll.y+c.y])}}});Scroller.implement(new Events,new Options)}if(String.prototype.toCurrency==null){String.prototype.toCurrency=function toCurrency(){var b=this.toString();var a=/^(.*\s)?([\-+\u00A3\u20AC]?\d+)(\d{3}\b)/;return b==(b=b.replace(a,"$1$2,$3"))?b:this.toCurrency(b)}}if(String.prototype.padLeft==null){String.prototype.padLeft=function padLeft(b,c){var a=this.toString();while(a.length<b){a=c+a}return a}}if(Number.prototype.toK==null){Number.prototype.toK=function toK(){var b=Number(this.toString());var a=Number(Math.abs(b));if((a.toInt()/1000000)>=1){return b.toFixedString(1000000,1,true)+"M"}if((a.toInt()/1000)>=1){return b.toFixedString(1000)+"K"}return b}}if(Number.prototype.toFixedString==null){Number.prototype.toFixedString=function toFixedString(){var i=this.toString();var h,g,c;var b=Array.prototype.slice.call(arguments);if(b.length>2){h=b.shift()}else{h=1}g=b.shift();c=b.shift();i=i/h;var f=parseFloat((i||"0").toString().replace(",",".").replace(/[^0-9e\.\-+]/g,""))||0;var e=Number(Math.abs(i)).toUnsignedString(g);if(isNaN(e)){e=0}e=(f<0?"-":"")+e;if(c==true){return e.toCurrency()}return Number(e)}}if(Number.prototype.toFixedString==null){Number.prototype.toUnsignedString=function toUnsignedString(c){var g=this.toString();var f,a,b;var e=""+Math.round(g*Math.pow(10,c));if(/\D/.test(e)){return""+g}e=e.padLeft(1+c,"0");f=e.substring(0,b=(e.length-c));a=e.substring(b);if(a){a="."+a}return f+a}}if(Node.prototype.preventTextSelection==null){var applyToTags=["p","h1","h2","h3","h4","h5","h6","li","a","img"];Node.prototype.preventTextSelection=function(b){if($type(this)!="element"){return this}if(!applyToTags.contains(this.getTag())){return this}var a={"-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-o-user-select":"none","user-select":"none"};this.setStyles(a);return this}}window.HkStylesExtra={Shortcuts:{list:{paddingTop:"2px",paddingBottom:"2px",marginLeft:"0px",marginRight:"0px",marginTop:"0px",marginBottom:"0px",clear:"both","float":"none",backgroundColor:"#0e0e0e",height:"auto",maxHeight:"800px",width:"auto",maxWidth:"1200px"},Form:{inputX:{verticalAlign:"middle"},inputY:{verticalAlign:"middle"},inputName:{verticalAlign:"middle",width:"90%"},submit:{margin:"0px",verticalAlign:"middle",cursor:"pointer"},load:{margin:"0px",verticalAlign:"middle",cursor:"pointer"},gotoPosition:{margin:"0px",verticalAlign:"middle",cursor:"pointer"},error:{},valid:{}},Entry:{deleteButton:{cursor:"pointer","float":"right",paddingTop:"3px"},text:{cursor:"pointer",width:"auto",marginLeft:"2px",marginRight:"20px",paddingTop:"3px",paddingBottom:"3px"},entry:{padding:"2px 0px",borderTop:"1px solid #303030",clear:"both"}},},window:{zIndex:"95000",margin:"auto",display:"block",position:"absolute",border:"1px solid #000","border-top-left-radius":"5px","border-top-right-radius":"5px",top:"50px",left:"auto",bottom:"auto",right:"auto",width:"auto",height:"auto",backgroundColor:"#0e0e0e",color:"#f2f2f2",overflow:"none",paddingBottom:"0px",borderTopLeftRadius:"10px",borderTopRightRadius:"10px",borderBottomLeftRadius:"5px"},footer:{clear:"both","float":"none",marginTop:"0px",paddingTop:"3px",paddingBottom:"0px",marginBottom:"0px",marginLeft:"0px",marginRight:"0px",height:"auto",width:"100%",backgroundColor:"#1a1a1a"},donate:{display:"block","float":"right",width:"auto",marginLeft:"auto"},scrollArea:{"float":"left",marginLeft:"0px",height:"16px",width:"auto",},scrollButton:{cursor:"pointer"},content:{margin:"0px",marginBottom:"0px",paddingTop:"2px",paddingBottom:"2px",overflow:"hidden",height:"48px",minHeight:"32px",maxHeight:"800px",width:"160px",minWidth:"120px",maxWidth:"1200px"},header:{zIndex:"96000",marginTop:"0px",marginBottom:"5px",paddingTop:"1px",paddingBottom:"1px",paddingLeft:"5px",paddingRight:"5px",borderTopLeftRadius:"10px",borderTopRightRadius:"10px",backgroundColor:"#1a1a1a"},title:{fontSize:"0.8em",paddingLeft:"3px",backgroundColor:"transparent",paddingBottom:"2px",marginTop:"4px",marginBottom:"2px",marginRight:"auto",width:"auto"},reduceButton:{zIndex:"97000",cursor:"pointer","float":"right",width:"22px",height:"18px",backgroundPosition:"-110px",backgroundRepeat:"no-repeat",backgroundImage:'url("http://cgit.compiz.org/fusion/decorators/emerald/plain/defaults/theme/buttons.min.png")'},updateLink:{zIndex:"97000",verticalAlign:"middle","float":"right",paddingTop:"2px",fontSize:"0px"},updateButton:{zIndex:"97000",border:" none"},resizeButton:{zIndex:"97000",verticalAlign:"middle","float":"right",cursor:"se-resize",border:" none",width:"12px",height:"12px",backgroundPosition:"0px 0px",backgroundImage:"url(http://openiconlibrary.sourceforge.net/gallery2/open_icon_library-full/icons_by_subject/graphics/png/32x32/cursor-corner-bottom-right.png)"},closeButton:{}};if("undefined"==typeof AssetLoader){var AssetLoader=new Class({initialize:function(a){this.completed=[];this.waiting=[];if(!!a){this.injectJavascript(a)}},injectJavascript:function injectJavascript(a){this.scriptsToInject=a;$each(a,function(b,c){this.waiting.push(c)},this);$each(a,function(b,c){if(!$(c)){this.inject(b,c)}else{this.setInjected(c)}},this)},inject:function inject(scriptDef,scriptName){if($(scriptName)){$(scriptName).remove()}var url=scriptDef.hasOwnProperty("url")?scriptDef.url:false;var conditions=scriptDef.hasOwnProperty("conditions")?eval(scriptDef.conditions):true;if(url&&conditions&&!$(scriptName)){new Asset.javascript(url,{id:scriptName})}this.check.delay(200,this,[scriptDef,scriptName])},check:function check(scriptDef,scriptName){var conditions=scriptDef.hasOwnProperty("conditions")?eval(scriptDef.conditions):false;if(conditions){this.inject.delay(1000,this,[scriptDef,scriptName])}else{this.setInjected(scriptName)}},setInjected:function setInjected(a){this.completed.push(a);this.waiting.remove(a)}})}if(!window.hasOwnProperty("HkToolkitCreateClasses")){window.HkToolkitCreateClasses=function(){try{if(!window.hasOwnProperty("Hk")){window.Hk=new Class({idScript:"HkToolkit",version:"2012.01.20.07.59.060000",Coords:{lastRegion:{x:0,y:0},lastGoto:{x:0,y:0},regExp:/\(?\s*([0-9]+)\s*[,.\-]\s*([0-9]+)\s*\)?/},doNothing:Class.empty,initialize:function(){try{this.HOMMK=window.HOMMK;this.Player=this.HOMMK.player;this.PlayerId=this.Player.get("id");this.UserId=this.Player.get("userId");this.AllianceId=this.Player.get("allianceId");this.AllianceName=this.Player.get("allianceName");this.Map=this.HOMMK.worldMap;this.WorldSize=this.Map.get("_size");this.WorldId=this.Player.get("worldId")}catch(j){window.console.log("[Hk][ERROR]Hk-Initialisierung fehlgeschlagen: "+j)}},getRegionName:function c(j,n){if(arguments.length==1){var l=this.HOMMK.getXYFromRegionNumber();j=l.x;n=l.y}var k=window.HOMMK.getRegionFromXY(j,n);var m="";if(k.content.hasOwnProperty("cN")){m+=k.content.cN;if(k.content.hasOwnProperty("pN")&&!!k.content.pN){m+=", "+k.content.pN}if(k.content.hasOwnProperty("iAN")&&!!k.content.iAN){m+=" ("+k.content.iAN+")"}}else{if(k.content.hasOwnProperty("rB")){m+=k.content.rB.n;if(k.content.rB.hasOwnProperty("owner")&&!!k.content.rB.owner){m+="("+k.content.rB.owner.name+")"}}else{m+="Region #"+window.HOMMK.getRegionNumberFromXY(j,n)}}return m},fixPosition:function e(j){if(j>this.WorldSize){return j-this.WorldSize}return j},validatePosition:function b(j){j=new Number(j).round();if(isNaN(j)||j<=0||j>this.WorldSize){return false}return j},gotoPosition:function i(j,m,k){var l;if(!$defined(k)){k=window.HOMMK.REGION_WORLDMAP_ZOOM_13X13}l=window.HOMMK.getRegionNumberFromXY(j,m);if(!this.validatePosition(j)||!this.validatePosition(m)){return false}window.HOMMK.setCurrentView(k,l,j,m);return true},getCurrentX:function h(){return this.validatePosition(this.Coords.lastRegion.x||window.HOMMK.currentView.regionX)},getCurrentY:function g(){return this.validatePosition(this.Coords.lastRegion.y||window.HOMMK.currentView.regionY)}})}}catch(f){window.console.log("[Hk][ERROR]"+f)}var a=function(){window.console.log("[PUBLIC][DEBUG]Starte HkToolkit\u2026");try{if(!window.hasOwnProperty("hkToolkit")){window.hkToolkit=new window.Hk()}if(!window.hasOwnProperty("hk")){window.hk=window.hkToolkit}}catch(j){window.console.log("[HkToolkit][ERROR]"+j)}window.HOMMK_HkToolkit=window.HOMMK_HkToolkit?window.HOMMK_HkToolkit:{version:window.hk.version}};return a};window.HkToolkitDependentObjectsAvailable=function(){return !!(window.HOMMK&&window.HOMMK.worldMap)}}window.console.log("Erzeuge Loader-Objekt\u2026");if(!window.hasOwnProperty("HkToolkitLoader")){window.HkToolkitLoader={loaded:false,load:function load(){if(window.HkToolkitLoader.loaded){window.console.log("[HkToolkitLoader][DEBUG]HkToolkit geladen\u2026");try{window.HkToolkitLoaderActive=$clear(window.HkToolkitLoaderActive)}catch(b){window.console.log("[HkToolkitLoader][Error]Fehler beim Beenden des Loaders: "+b)}return}window.console.log("[HkToolkitLoader][DEBUG]Warte auf Objekte\u2026");if(!!(window.HOMMK&&window.HOMMK.worldMap&&window.HkToolkitCreateClasses&&window.HkToolkitDependentObjectsAvailable&&window.HkToolkitDependentObjectsAvailable())){window.console.log("[HkToolkitLoader][DEBUG]Objekte verfügbar, bereite HkToolkit vor\u2026");try{window.HkToolkitLoader.loaded=true;var a=window.HkToolkitCreateClasses();a()}catch(b){window.console.log("[HkToolkitLoader][ERROR]Fehler beim Erzeugen der Klassen für HkToolkit: "+b)}}else{window.console.log("[HkToolkitLoader][DEBUG]HkToolkit wartet auf die Verfügbarkeit von Objekten.")}}}}window.console.log("Starte Loader\u2026");try{if(!window.hasOwnProperty("HkToolkitLoaderActive")){window.HkToolkitLoaderActive=window.HkToolkitLoader.load.periodical(1000)}}catch(ex){window.console.log("[HkPublic][DEBUG]Fehler beim Laden von HkToolkit: "+ex)}if(!window.hasOwnProperty("HkStore")){window.HkStore={}}if(!window.hasOwnProperty("HkStorageCreateClasses")){window.HkStorageCreateClasses=function(){try{if(window.hasOwnProperty("Hk")&&!windowOwnProperty("HkStorage")){window.Hk.HkStorage=new Class({$debug:1,storageKey:"HkStorage"+window.hk.PlayerId+""+window.hk.WorldId,options:{storageKey:"HkStorage"+window.hk.PlayerId+""+window.hk.WorldId,clearStorage:false},initialize:function(l){try{window.console.log("[HkPublic][DEBUG]Bereite HkStorage vor\u2026");this.setOptions(l);this.storageKey=this.options.storageKey;window.console.log("[HkPublic][DEBUG]Initialisiere HkStorage #"+this.storageKey);if(this.options.clearStorage){this.clearStorage()}if(this.isEmpty()){window.console.log("[HkStorage][DEBUG]Erzeuge lokalen Speicher für #"+this.storageKey);this.setStorageData({})}}catch(m){window.console.log("[HkStorage][ERROR]Initialisierungsfehler: "+m)}},drop:function b(l){window.console.log("[HkStorage][DEBUG]Entferne "+l+" aus "+this.storageKey);var m=this.getStorageData();if($defined(m.key)||m.hasOwnProperty(l)){var n=m[l];delete m[l];this.setStorageData(m);return n}else{window.console.log("[HkStorage][INFO]Kein Eintrag "+l+" in "+this.storageKey)}return false},dropAll:function a(){var l=this.pull();window.console.log("[HkStorage][DEBUG]Entferne Daten aus "+this.storageKey);if(l){$each(l,function(n,m){window.console.log("[HkStorage][DEBUG]Verarbeite "+m);this.drop(m)}.bind(this))}},push:function h(l,m){if(arguments.length<2){window.console.log("[HkStorage][DEBUG]Speichere Daten: "+Json.toString(l))}else{window.console.log("[HkStorage][DEBUG]Speichere Daten unter #"+l+": "+Json.toString(m))}var n=this.getStorageData();if(arguments.length<2){$each(l,function(p,o){n[o]=p})}else{n[l]=m}this.setStorageData(n)},pull:function j(l){var n=this.getStorageData();if("null"==typeof n){window.console.log("[HkStorage.pull][DEBUG]null-Datentyp im Speicher");n={}}else{window.console.log("[HkStorage.pull][DEBUG]Datentyp im Speicher: "+typeof n)}if(!l){window.console.log("[HkStorage][DEBUG]Kein Schlüssel angefragt, liefere alle Daten zurück: "+Json.toString(l));var o={};for(d in n){window.console.log("[HkStorage][DEBUG]Prüfe Eintrag: "+Json.toString(d));if("function"==$type(n[d])){continue}window.console.log("[HkStorage][DEBUG]Eintrag akzeptiert.");o[d]=n[d]}return o}if(!n.hasOwnProperty(l)){return{}}var m=n[l];return m},isEmpty:function e(l){var m=$H(this.getStorageData()).keys();if(m==null||m.length<=0){window.console.log("[HkStorage][DEBUG]Keine Daten in #"+this.storageKey+": "+Json.toString(m));return true}return false},getStorageData:function c(){var l=window.localStorage.getItem(this.storageKey);window.console.log("[HkStorage][DEBUG]Abgerufene Daten aus #"+this.storageKey+": "+Json.toString(l));if(null==typeof l||!l){return{}}l=Json.evaluate(l);return l},setStorageData:function k(m){var l=Json.toString(m);window.console.log("[HkStorage][DEBUG]Speichere Daten in #"+this.storageKey+": "+l);window.localStorage.setItem(this.storageKey,l);this.fireEvent("onStorageUpdate",m);return m},clearStorage:function f(){window.console.log("[HkStorage][DEBUG]Leere Speicher...");window.localStorage.clear();this.fireEvent("onStorageUpdate",{})}});window.Hk.HkStorage.implement(new Events,new Options)}}catch(g){window.console.log("[HkStorage][ERROR]"+g);throw new Exception(g)}var i=function(){try{if(!window.hk.hasOwnProperty("Storage")){window.hk.Storage={Common:new window.Hk.HkStorage()}}}catch(l){window.console.log("[HkStorage.Common][ERROR]"+l);throw new Exception(l)}};return i};window.HkStorageDependentObjectsAvailable=function(){return !!(window.Hk&&window.hk)}}window.console.log("Erzeuge Loader-Objekt\u2026");if(!window.hasOwnProperty("HkStorageLoader")){window.HkStorageLoader={loaded:false,load:function load(){if(window.HkStorageLoader.loaded){window.console.log("[HkStorageLoader][DEBUG]HkStorage geladen\u2026");try{window.HkStorageLoaderActive=$clear(window.HkStorageLoaderActive)}catch(b){window.console.log("[HkStorageLoader][Error]Fehler beim Beenden des Loaders: "+b)}return}window.console.log("[HkStorageLoader][DEBUG]Warte auf Objekte\u2026");if(!!(window.Hk&&window.hk&&window.HkStorageCreateClasses&&window.HkStorageDependentObjectsAvailable&&window.HkStorageDependentObjectsAvailable())){window.console.log("[HkStorageLoader][DEBUG]Objekte verfügbar, bereite HkStorage vor\u2026");try{window.HkStorageLoader.loaded=true;var a=window.HkStorageCreateClasses();a()}catch(b){window.console.log("[HkStorageLoader][ERROR]Fehler beim Erzeugen der Klassen für HkStorage: "+b)}}else{window.console.log("[HkStorageLoader][DEBUG]HkStorage wartet auf die Verfügbarkeit von Objekten.")}}}}window.console.log("Starte Loader\u2026");try{if(!window.hasOwnProperty("HkStorageLoaderActive")){window.HkStorageLoaderActive=window.HkStorageLoader.load.periodical(1000)}}catch(ex){window.console.log("[HkPublic][DEBUG]Fehler beim Laden von HkStorage: "+ex)}if(!window.hasOwnProperty("HkReducerCreateClasses")){window.HkReducerCreateClasses=function(){if(!Hk.hasOwnProperty("HkReducer")){Hk.HkReducer=new Class({$debug:1,$status:null,$default:"TargetVisible",IS_REDUCED:"TargetReduced",IS_VISIBLE:"TargetVisible",options:{duration:500},initialize:function(f,h,g){this.setOptions(g);this.toggle=f;this.target=h;var i=this.options;i.onChange=function(j){window.console.log("[HkReducer][Event]Slider Change Event");window.console.log(j);this.fireEvent("onTargetChange",[this.toggle,this.target])}.bind(this);i.onTick=function(j){window.console.log("[HkReducer][Event]Slider Tick Event");window.console.log(j);this.fireEvent("onTargetStep",[this.toggle,this.target])}.bind(this);i.onComplete=function(j){window.console.log("[HkReducer][Event]Slider Complete Event");window.console.log(j);this.$status=(this.$status==this.IS_REDUCED)?this.IS_VISIBLE:this.IS_REDUCED;this.fireEvent("on"+this.$status,[this.toggle,this.target]);this.updateDimensions(this.target);this.fireEvent("onTargetComplete",[this.toggle,this.target])}.bind(this);this.toggle.slider=new Fx.Slide(this.target,i);this.toggle.target=this.target;this.toggle.reducer=this;this.target.reducer=this;this.toggle.addEvent("mousedown",this.togglePressed.bind(this));this.toggle.addEvent("click",this.toggleClicked.bind(this));if(this.$status==null){this.$status=this.$default}window.console.log(this.toggle.slider);this.updateDimensions(this.target)},togglePressed:function c(g){var f=g.target;var i=f.target;var h=f.slider;if(this.$status==this.IS_VISIBLE){window.console.log("[HkReducer][Event]Target height: "+i.style.height)}else{window.console.log("[HkReducer][Event]Target height: "+i.style.height)}},toggleClicked:function b(g){var f=g.target;var i=f.target;var h=f.slider;if(this.$status==this.IS_VISIBLE){h.slideOut()}else{h.slideIn()}},updateDimensions:function e(j){window.console.log("[HkReducer][DEBUG]Passe die Größen an\u2026");var i=j.getElementsByTagName("div");$each(i,function(m){var n=$(m).getStyle("height");var l=m.id||"N/A";window.console.log("[HkReducer][DEBUG]Passe die Höhe des Containers #"+l+" an ("+n+")\u2026");if($chk(n)&&n.toInt()<=0&&n!="auto"){window.console.log("[HkReducer][DEBUG]Setze Höhe des Containers #"+l+": "+n+" \u2192 auto\u2026");m.setStyle("height","auto")}else{window.console.log("[HkReducer][DEBUG]Lasse die Höhe des Containers #"+l+" unverändert ("+n+")\u2026")}});var g=j.id||"N/A";var f=$(j).getStyle("height");window.console.log("[HkReducer][DEBUG]Setze Höhe des Hauptelements #"+g+": "+f+" \u2192 auto\u2026");j.setStyle("height","auto");var h=$(j.getParent).getStyle("height");var k=j.getParent().getCoordinates().height+"px";window.console.log("[HkReducer][DEBUG]Setze Höhe des Slide-Elements: "+h+" \u2192 "+k+"\u2026");j.getParent().setStyle("height",k)}});Hk.HkReducer.implement(new Events,new Options)}var a=function(){};return a};window.HkReducerDependentObjectsAvailable=function(){return !!(window.Hk&&window.hk&&window.Hk.HkStorage&&window.hk.Storage)}}window.console.log("Erzeuge Loader-Objekt\u2026");if(!window.hasOwnProperty("HkReducerLoader")){window.HkReducerLoader={loaded:false,load:function load(){if(window.HkReducerLoader.loaded){window.console.log("[HkReducerLoader][DEBUG]HkReducer geladen\u2026");try{window.HkReducerLoaderActive=$clear(window.HkReducerLoaderActive)}catch(b){window.console.log("[HkReducerLoader][Error]Fehler beim Beenden des Loaders: "+b)}return}window.console.log("[HkReducerLoader][DEBUG]Warte auf Objekte\u2026");if(!!(window.HkStorage&&window.hk.Storage&&window.HkReducerCreateClasses&&window.HkReducerDependentObjectsAvailable&&window.HkReducerDependentObjectsAvailable())){window.console.log("[HkReducerLoader][DEBUG]Objekte verfügbar, bereite HkReducer vor\u2026");try{window.HkReducerLoader.loaded=true;var a=window.HkReducerCreateClasses();a()}catch(b){window.console.log("[HkReducerLoader][ERROR]Fehler beim Erzeugen der Klassen für HkReducer: "+b)}}else{window.console.log("[HkReducerLoader][DEBUG]HkReducer wartet auf die Verfügbarkeit von Objekten.")}}}}window.console.log("Starte Loader\u2026");try{if(!window.hasOwnProperty("HkReducerLoaderActive")){window.HkReducerLoaderActive=window.HkReducerLoader.load.periodical(1000)}}catch(ex){window.console.log("[HkPublic][DEBUG]Fehler beim Laden von HkReducer: "+ex)}if(!window.hasOwnProperty("HkWindowsCreateClasses")){window.HkWindowsCreateClasses=function(){var j=window.Hk;var g=window.hk;if(g.hasOwnProperty("Storage")&&!g.Storage.hasOwnProperty("HkWindows")){g.Storage.HkWindows=new j.HkStorage({storageKey:"HkWindowsInternal"})}if(!j.hasOwnProperty("HkWindows")){j.HkWindows=new Class({$debug:1,storage:window.hk.Storage.HkWindows,windows:[],options:{id:"HkWindow",reduceable:true,closeable:false,draggable:true,resizeable:true,scrollable:true,autoScroll:true,title:"HkWindow",createHeader:true,createTitle:true,createContentContainer:true,createDonateButton:false,preventTextSelection:true,addToDOM:true,reduce:false,updateable:true,updateUrl:"http://userscripts.org/scripts/source/121763.user.js",scroller:false,scrollers:{up:Class.empty,down:Class.empty},windowStyles:window.HkStylesExtra.window,footerStyles:window.HkStylesExtra.footer,donateStyles:window.HkStylesExtra.donate,scrollAreaStyles:window.HkStylesExtra.scrollArea,scrollButtonStyles:window.HkStylesExtra.scrollButton,resizeButtonStyles:window.HkStylesExtra.resizeButton,headerStyles:window.HkStylesExtra.header,titleStyles:window.HkStylesExtra.title,reduceButtonStyles:window.HkStylesExtra.reduceButton,closeButtonStyles:window.HkStylesExtra.closeButton,updateButtonStyles:window.HkStylesExtra.updateButton,updateLinkStyles:window.HkStylesExtra.updateLink,contentStyles:window.HkStylesExtra.content,},initialize:function(H){this.setOptions(H);this.options.scrollers.up=this.scrollUp;this.options.scrollers.down=this.scrollDown},createWindow:function f(I,P){this.setOptions(P);var N=this.getWindowId(I,P);var H=new Element("div",{id:N,"class":"HkWindow Radius5BottomLeft Radius10TopLeft Radius10TopRight",styles:this.options.windowStyles});var K;if(this.options.createContentContainer){K=this.createContentContainer(I,P)}else{K=new Object}if(this.options.createHeader){var O=this.createHeader(I,P);H.adopt(O);if(this.options.draggable){new Drag.Move(H,{handle:O,hkWindow:this,hkWindowId:I,onComplete:function(Q){window.console.log("[HkWindow][DEBUG]Drag Complete Event an "+this.options.hkWindowId);if(!this.options.hkWindow.saveWindowPosition(this.options.hkWindowId,this.options.hkWindow.options)){window.console.log("[HkWindow][DEBUG]Drag Event Handler saveWindowPosition fehlgeschlagen für "+H.hkWindowId)}}})}}if(this.options.createContentContainer){H.adopt(K)}var M=this.createFooter(I,P);if(this.options.resizeable){window.console.log("[HkWindow][DEBUG]Erzeuge Resize-Button für "+I);var L=this.createResizeButton(I,P);M.adopt(L)}if(this.options.scrollable&&!this.options.autoScroll){var J=this.createScrollArea(I,P);M.adopt(J)}H.adopt(M);if(this.options.addToDOM){$("MainContainer").adopt(H);if(this.options.resizeable){this.makeResizeable(I,P,K)}this.windows.push(H)}this.loadWindowPosition(I,P);return H},getWindowNode:function C(J,H){window.console.log("[HkWindow][DEBUG]Rufe Fenster-Knoten für "+J);var I=$(this.getWindowId(J,H));return"undefined"==typeof I?null:I},getWindowPosition:function w(K,H){var I=this.getWindowNode(K,H);if(I==null){return null}var J=I.getPosition();window.console.log("[HkWindow][DEBUG]Abgerufene Fensterposition für  "+I.id+": "+Json.toString(J));return J},setWindowPosition:function i(L,K,H){var J=this.getWindowNode(K,H);if(J==null){return null}window.console.log("[HkWindow][DEBUG]Setze Fensterposition für  "+J.id+": "+Json.toString(L));if("undefined"==typeof L||!L||!("x" in L)||!("y" in L)){return null}var I={top:L.y,left:L.x};J.setStyles(I);return I},loadWindowPosition:function e(L,H){var J=this.getWindowNode(L,H);if(J==null){return null}var I="WindowPosition"+J.id;var K=this.storage.pull(I);window.console.log("[HkWindow][DEBUG]Geladene Fensterposition für  "+I+": "+Json.toString(K));if("undefined"==typeof K||!K||!("x" in K)||!("y" in K)){K=this.saveWindowPosition(L,H)}this.setWindowPosition(K,L,H);return K},saveWindowPosition:function y(L,H){var J;if((J=this.getWindowNode(L,H))==null){return null}var I="WindowPosition"+J.id;var K=this.getWindowPosition(L,H);window.console.log("[HkWindow][DEBUG]Speichere Fensterposition für  "+I+": "+Json.toString(K));this.storage.push(I,K);return K},showScrollButtons:function c(I,H){},hideScrollButtons:function E(I,H){},createFooter:function l(L,J){this.setOptions(J);var K=this.getId("HkWindowFooter",L,J);var H=new Element("div",{id:K,"class":"Radius5BottomLeft",styles:this.options.footerStyles});if(this.options.createDonateButton){var I=new Element("form",{action:"https://www.paypal.com/cgi-bin/webscr",method:"post",target:"_blank",alt:"Unterstütze den Entwickler!",title:"Unterstütze den Entwickler!",name:"Unterstütze den Entwickler!",styles:this.options.donateStyles});I.innerHTML='<input type="hidden" name="cmd" value="_s-xclick"><input type="hidden" name="hosted_button_id" value="WRWUH9K7JBMBY"><input type="image" src="http://icons.iconarchive.com/icons/visualpharm/magnets/16/coins-icon.png" border="0" name="submit" title="Den Entwickler unterstützen!" name="Den Entwickler unterstützen!" alt="Den Entwickler unterstützen!"><img alt="" border="0" src="https://www.paypalobjects.com/de_DE/i/scr/pixel.gif" width="1" height="1">';H.adopt(I)}return H},createScrollArea:function D(K,H){this.setOptions(H);var I=this.getId("HkWindowScrollers",K,H);var J=new Element("div",{id:I,styles:this.options.scrollAreaStyles});$each(this.options.scrollers,function(N,L){var M=this.createScrollButton(K,H,L,N);J.adopt(M)}.bind(this));return J},createScrollButton:function A(M,H,K,I){this.setOptions(H);if(K!="up"&&K!="down"){K="down"}var L=this.getId("HkWindowScroll"+K,M,H);var J=new Element("img",{id:L,src:"http://icons.iconarchive.com/icons/saki/nuoveXT/16/Small-arrow-"+K+"-icon.png",styles:this.options.scrollButtonStyles});J.dir=K;J.srcId=M;J.btnId=L;J.btnOpts=H;J.btnWindow=this;J.addEvent("click",I.bind(this));return J},scrollUp:function p(J){window.console.log("[HkWindow][DEBUG]scrollUp:");var L=J.target.btnWindow.getWindowId(J.target.srcId,J.target.btnOpts);window.console.log("[HkWindow][DEBUG]Fenster-ID: "+L);var I=$(L).getElement(".HkContent");window.console.log(I.getSize());var K=I.getSize().size;var H=I.getSize().scroll;var M=I.getSize().scrollSize;var N=H.y-20<0?0:H.y-20;window.console.log("[HkWindow][DEBUG]Scrolle zu Y="+N);I.scrollTo(H.x,N);window.console.log(I.getSize())},scrollDown:function G(J){window.console.log("[HkWindow][DEBUG]scrollDown:");var L=J.target.btnWindow.getWindowId(J.target.srcId,J.target.btnOpts);window.console.log("[HkWindow][DEBUG]Fenster-ID: "+L);var I=$(L).getElement(".HkContent");window.console.log(I.getSize());var K=I.getSize().size;var H=I.getSize().scroll;var M=I.getSize().scrollSize;var N=H.y+K.y+20>M.y?M.y-K.y:H.y+20;window.console.log("[HkWindow][DEBUG]Scrolle zu Y="+N);I.scrollTo(H.x,N);window.console.log(I.getSize())},getId:function s(I,J,H){return I+$pick($pick(J,this.options.id),this.id)},getWindowId:function n(I,H){return this.getId("HkWindow",I,H)},createHeader:function r(N,K){this.setOptions(K);var L=this.getId("HkWindowHeader",N,K);var I=new Element("div",{id:L,"class":"HkWindowHeader GradientGreyDarkgreyGrey Radius10TopLeft Radius10TopRight",styles:this.options.headerStyles});if(this.options.reduceable){var H=this.createReduceButton(N,K);I.adopt(H)}if(this.options.updateable){var J=this.createUpdateButton(N,K);I.adopt(J)}if(this.options.createTitle){var M=this.createTitle(N,K);I.adopt(M)}return I},createTitle:function m(K,H){this.setOptions(H);var I=this.getId("HkWindowTitle",K,H);var J=new Element("h1",{id:I,"class":"HkWindowTitle Radius10TopLeft Radius10TopRight",styles:this.options.titleStyles});J.setText(this.options.title);if(this.options.preventTextSelection){J.preventTextSelection()}if(this.options.draggable){new Drag.Move($(this.getWindowId(K,H)),{handle:J});J.setStyles({cursor:"move"})}return J},createUpdateButton:function b(K,J){this.setOptions(J);var H=new Element("a",{href:this.options.updateUrl,target:"_blank",styles:this.options.updateLinkStyles});var I=new Element("img",{alt:"Erzwinge Aktualisierung",title:"Erzwinge Aktualisierung",name:"Erzwinge Aktualisierung",src:"http://icons.iconarchive.com/icons/saki/snowish/16/Apps-system-software-update-icon.png",styles:this.options.updateButtonStyles});H.adopt(I);if(this.options.preventTextSelection){H.preventTextSelection()}return H},createCloseButton:function t(J,I){this.setOptions(I);var H=new Element("div",{"class":"HkClose HkButton",styles:this.options.closeButtonStyles});return H},createContentContainer:function B(K,I){this.setOptions(I);var J=this.getId("HkWindowContent",K,I);var H=new Element("div",{id:J,"class":"HkContent",styles:this.options.contentStyles});if(this.options.preventTextSelection){H.preventTextSelection()}return H},makeScrollable:function x(J,I){this.setOptions(I);if(!this.options.scroll||!this.options.autoScroll){return}var H=$(this.options.scroll);this.options.scroller=new Scroller(H);this.options.scroller.start()},createReduceButton:function v(J,I){this.setOptions(I);var H=new Element("div",{"class":"HkReduce HkButton",title:"Einrollen",name:"Einrollen",styles:this.options.reduceButtonStyles});H.setOpacity("0.8");if(this.options.preventTextSelection){H.preventTextSelection()}return H},makeReduceable:function q(L,J){this.setOptions(J);if(!this.options.reduce){return}var K=$(this.options.reduce);var I=$(this.getWindowId(L)).getElementsByTagName("div");var H=false;$each(I,function(M){M=$(M);if(M.hasClass("HkReduce")){H=M}});if(H&&K){new j.HkReducer(H,K,{hkWindowId:L,hkWindow:this})}},createResizeButton:function F(K,H){var J=this.getId("HkWindowResize",K,H);var I=new Element("div",{id:J,"class":"HkWindowResizeButton",styles:this.options.resizeButtonStyles});if(this.options.preventTextSelection){I.preventTextSelection()}return I},makeResizeable:function u(K,I,H){this.setOptions(I);if(!this.options.resizeable){return}var J=this.getId("HkWindowResize",K,I);H=$(($defined(H)?H:this.getId("HkWindow",K,I)));this.resizeElement=$(H);window.console.log("[HkWindow][DEBUG]Erzeuge Resizeable-Funktion via "+J);new Drag.Base(H,{handle:$(J),hkResize:this.resizeElement,hkWindow:this,hkWindowId:K,modifiers:{x:"width",y:"height"},onStart:function(L){window.console.log("[HkWindow][Event]Resize Start Event an "+this.options.hkWindowId)},onDrag:function(L){window.console.log("[HkWindow][Event]Resize Event an "+this.options.hkWindowId)},onComplete:function(L){window.console.log("[HkWindow][Event]Resize Complete Event an "+this.options.hkWindowId);if(this.options.hkWindow.options.reduceable){window.console.log("[HkWindow][DEBUG]Löse Höhenfestlegung durch Reduceable für "+this.options.hkWindowId);var M=L.getParent();if(M.getStyle("overflow")=="hidden"&&M.getStyle("height")!="auto"){M.setStyle("height","auto")}}if(!this.options.hkWindow.saveWindowSize(this.options.hkWindowId,this.options.hkWindow.options)){window.console.log("[HkWindow][WARN]Resize Event Handler saveWindowSize fehlgeschlagen für "+this.options.hkWindowId)}}})},getWindowSize:function z(K,H){var J=this.resizeElement||this.getWindowNode(K,H);if(J==null){return null}var I=J.getSize();window.console.log("[HkWindow][DEBUG]Abgerufene Fenstergröße für  "+J.id+": "+Json.toString(I));return I},setWindowSize:function o(J,L,I){var K=this.resizeElement||this.getWindowNode(L,I);if(K==null){return null}window.console.log("[HkWindow][DEBUG]Setze Fenstergröße für  "+K.id+": "+Json.toString(J));if("undefined"==typeof J||!J||!("size" in J)||!("x" in J.size)||!("y" in J.size)){return null}var H={width:J.size.x,height:J.size.y};K.setStyles(H);return H},loadWindowSize:function k(L,H){var K=this.resizeElement||this.getWindowNode(L,H);if(K==null){return null}var J="WindowSize"+K.id;var I=this.storage.pull(J);window.console.log("[HkWindow][DEBUG]Geladene Fenstergröße für  "+J+": "+Json.toString(I));if("undefined"==typeof I||!I||!("size" in I)||!("x" in I.size)||!("y" in I.size)){I=this.saveWindowSize(L,H)}this.setWindowSize(I,L,H);return I},saveWindowSize:function a(L,H){var K=this.resizeElement||this.getWindowNode(L,H);if(K==null){return null}var J="WindowSize"+K.id;var I=this.getWindowSize(L,H);window.console.log("[HkWindow][DEBUG]Speichere Fenstergröße für  "+J+": "+Json.toString(I));this.storage.push(J,I);return I}});window.Hk.HkWindows.implement(new Events,new Options)}var h=function(){if(!window.hk.hasOwnProperty("Windows")){window.hk.Windows=new window.Hk.HkWindows()}};return h};window.HkWindowsDependentObjectsAvailable=function(){return !!(window.Hk&&window.hk&&window.Hk.HkReducer)}}window.console.log("Erzeuge Loader-Objekt\u2026");if(!window.hasOwnProperty("HkWindowsLoader")){window.HkWindowsLoader={loaded:false,load:function load(){if(window.HkWindowsLoader.loaded){window.console.log("[HkWindowsLoader][DEBUG]HkWindows geladen\u2026");try{window.HkWindowsLoaderActive=$clear(window.HkWindowsLoaderActive)}catch(b){window.console.log("[HkWindowsLoader][Error]Fehler beim Beenden des Loaders: "+b)}return}window.console.log("[HkWindowsLoader][DEBUG]Warte auf Objekte\u2026");if(!!(window.HkReducer&&window.hk.Storage&&window.HkWindowsCreateClasses&&window.HkWindowsDependentObjectsAvailable&&window.HkWindowsDependentObjectsAvailable())){window.console.log("[HkWindowsLoader][DEBUG]Objekte verfügbar, bereite HkWindows vor\u2026");try{window.HkWindowsLoader.loaded=true;var a=window.HkWindowsCreateClasses();a()}catch(b){window.console.log("[HkWindowsLoader][ERROR]Fehler beim Erzeugen der Klassen für HkWindows: "+b)}}else{window.console.log("[HkWindowsLoader][DEBUG]HkWindows wartet auf die Verfügbarkeit von Objekten.")}}}}window.console.log("Starte Loader\u2026");try{if(!window.hasOwnProperty("HkWindowsLoaderActive")){window.HkWindowsLoaderActive=window.HkWindowsLoader.load.periodical(1000)}}catch(ex){window.console.log("[HkPublic][DEBUG]Fehler beim Laden von HkWindows: "+ex)}window.$debug=1;try{if(!window.hasOwnProperty("HkShortcutsAssetLoader")){window.HkShortcutsAssetLoader=new AssetLoader({SHA256CryptoJs:{url:"http://crypto-js.googlecode.com/files/2.5.3-crypto-sha256.js"}})}}catch(ex){window.console.log("[HkShortcutsAssetLoader][ERROR]"+ex)}if(!window.hasOwnProperty("HkShortcutsCreateClasses")){window.HkShortcutsCreateClasses=function(){window.console.log("[HkPublic][DEBUG]Erzeuge Klassen\u2026");window.HkStore={};try{}catch(ab){window.console.log("[HkDataStorage][ERROR]"+ab)}try{window.Hk.HkStorage=new Class({$debug:1,storageKey:"HkStorage"+window.hk.PlayerId+""+window.hk.WorldId,options:{storageKey:"HkStorage"+window.hk.PlayerId+""+window.hk.WorldId,clearStorage:false},initialize:function(x){try{window.console.log("[HkPublic][DEBUG]Bereite HkStorage vor\u2026");this.setOptions(x);this.storageKey=this.options.storageKey;window.console.log("[HkPublic][DEBUG]Initialisiere HkStorage #"+this.storageKey);if(this.options.clearStorage){this.clearStorage()}if(this.isEmpty()){window.console.log("[HkStorage][DEBUG]Erzeuge lokalen Speicher für #"+this.storageKey);this.setStorageData({})}}catch(y){window.console.log("[HkStorage][ERROR]Initialisierungsfehler: "+y)}},drop:function E(x){window.console.log("[HkStorage][DEBUG]Entferne "+x+" aus "+this.storageKey);var y=this.getStorageData();if($defined(y.key)||y.hasOwnProperty(x)){var an=y[x];delete y[x];this.setStorageData(y);return an}else{window.console.log("[HkStorage][INFO]Kein Eintrag "+x+" in "+this.storageKey)}return false},dropAll:function Z(){var x=this.pull();window.console.log("[HkStorage][DEBUG]Entferne Daten aus "+this.storageKey);if(x){$each(x,function(an,y){window.console.log("[HkStorage][DEBUG]Verarbeite "+y);this.drop(y)}.bind(this))}},push:function ad(x,y){if(arguments.length<2){window.console.log("[HkStorage][DEBUG]Speichere Daten: "+Json.toString(x))}else{window.console.log("[HkStorage][DEBUG]Speichere Daten unter #"+x+": "+Json.toString(y))}var an=this.getStorageData();if(arguments.length<2){$each(x,function(ap,ao){an[ao]=ap})}else{an[x]=y}this.setStorageData(an)},pull:function c(x){var an=this.getStorageData();if("null"==typeof an){window.console.log("[HkStorage.pull][DEBUG]null-Datentyp im Speicher");an={}}else{window.console.log("[HkStorage.pull][DEBUG]Datentyp im Speicher: "+typeof an)}if(!x){window.console.log("[HkStorage][DEBUG]Kein Schlüssel angefragt, liefere alle Daten zurück: "+Json.toString(x));var ao={};for(d in an){window.console.log("[HkStorage][DEBUG]Prüfe Eintrag: "+Json.toString(d));if("function"==$type(an[d])){continue}window.console.log("[HkStorage][DEBUG]Eintrag akzeptiert.");ao[d]=an[d]}return ao}if(!an.hasOwnProperty(x)){return{}}var y=an[x];return y},isEmpty:function z(x){var y=$H(this.getStorageData()).keys();if(y==null||y.length<=0){window.console.log("[HkStorage][DEBUG]Keine Daten in #"+this.storageKey+": "+Json.toString(y));return true}return false},getStorageData:function K(){var x=window.localStorage.getItem(this.storageKey);window.console.log("[HkStorage][DEBUG]Abgerufene Daten aus #"+this.storageKey+": "+Json.toString(x));if(null==typeof x||!x){return{}}x=Json.evaluate(x);return x},setStorageData:function q(y){var x=Json.toString(y);window.console.log("[HkStorage][DEBUG]Speichere Daten in #"+this.storageKey+": "+x);window.localStorage.setItem(this.storageKey,x);this.fireEvent("onStorageUpdate",y);return y},clearStorage:function t(){window.console.log("[HkStorage][DEBUG]Leere Speicher...");window.localStorage.clear();this.fireEvent("onStorageUpdate",{})}});window.Hk.HkStorage.implement(new Events,new Options)}catch(ab){window.console.log("[HkStorage][ERROR]"+ab);throw new Exception(ab)}try{hk.Storage={Common:new Hk.HkStorage()}}catch(ab){window.console.log("[HkStorage.Common][ERROR]"+ab);throw new Exception(ab)}Hk.HkReducer=new Class({$debug:1,$status:null,$default:"TargetVisible",IS_REDUCED:"TargetReduced",IS_VISIBLE:"TargetVisible",options:{duration:500},initialize:function(x,an,y){this.setOptions(y);this.toggle=x;this.target=an;var ao=this.options;ao.onChange=function(ap){window.console.log("[HkReducer][Event]Slider Change Event");window.console.log(ap);this.fireEvent("onTargetChange",[this.toggle,this.target])}.bind(this);ao.onTick=function(ap){window.console.log("[HkReducer][Event]Slider Tick Event");window.console.log(ap);this.fireEvent("onTargetStep",[this.toggle,this.target])}.bind(this);ao.onComplete=function(ap){window.console.log("[HkReducer][Event]Slider Complete Event");window.console.log(ap);this.$status=(this.$status==this.IS_REDUCED)?this.IS_VISIBLE:this.IS_REDUCED;this.fireEvent("on"+this.$status,[this.toggle,this.target]);this.updateDimensions(this.target);this.fireEvent("onTargetComplete",[this.toggle,this.target])}.bind(this);this.toggle.slider=new Fx.Slide(this.target,ao);this.toggle.target=this.target;this.toggle.reducer=this;this.target.reducer=this;this.toggle.addEvent("mousedown",this.togglePressed.bind(this));this.toggle.addEvent("click",this.toggleClicked.bind(this));if(this.$status==null){this.$status=this.$default}window.console.log(this.toggle.slider);this.updateDimensions(this.target)},togglePressed:function R(y){var x=y.target;var ao=x.target;var an=x.slider;if(this.$status==this.IS_VISIBLE){window.console.log("[HkReducer][Event]Target height: "+ao.style.height)}else{window.console.log("[HkReducer][Event]Target height: "+ao.style.height)}},toggleClicked:function ac(y){var x=y.target;var ao=x.target;var an=x.slider;if(this.$status==this.IS_VISIBLE){an.slideOut()}else{an.slideIn()}},updateDimensions:function M(ap){window.console.log("[HkReducer][DEBUG]Passe die Größen an\u2026");var ao=ap.getElementsByTagName("div");$each(ao,function(at){var au=$(at).getStyle("height");var ar=at.id||"N/A";window.console.log("[HkReducer][DEBUG]Passe die Höhe des Containers #"+ar+" an ("+au+")\u2026");if($chk(au)&&au.toInt()<=0&&au!="auto"){window.console.log("[HkReducer][DEBUG]Setze Höhe des Containers #"+ar+": "+au+" \u2192 auto\u2026");at.setStyle("height","auto")}else{window.console.log("[HkReducer][DEBUG]Lasse die Höhe des Containers #"+ar+" unverändert ("+au+")\u2026")}});var y=ap.id||"N/A";var x=$(ap).getStyle("height");window.console.log("[HkReducer][DEBUG]Setze Höhe des Hauptelements #"+y+": "+x+" \u2192 auto\u2026");ap.setStyle("height","auto");var an=$(ap.getParent).getStyle("height");var aq=ap.getParent().getCoordinates().height+"px";window.console.log("[HkReducer][DEBUG]Setze Höhe des Slide-Elements: "+an+" \u2192 "+aq+"\u2026");ap.getParent().setStyle("height",aq)}});Hk.HkReducer.implement(new Events,new Options);hk.Storage.HkWindows=new Hk.HkStorage({storageKey:"HkWindowsInternal"});Hk.HkWindows=new Class({$debug:1,storage:window.hk.Storage.HkWindows,windows:[],options:{id:"HkWindow",reduceable:true,closeable:false,draggable:true,resizeable:true,scrollable:true,autoScroll:true,title:"HkWindow",createHeader:true,createTitle:true,createContentContainer:true,createDonateButton:false,preventTextSelection:true,addToDOM:true,reduce:false,updateable:true,updateUrl:"http://userscripts.org/scripts/source/121763.user.js",scroller:false,scrollers:{up:Class.empty,down:Class.empty},windowStyles:window.HkStylesExtra.window,footerStyles:window.HkStylesExtra.footer,donateStyles:window.HkStylesExtra.donate,scrollAreaStyles:window.HkStylesExtra.scrollArea,scrollButtonStyles:window.HkStylesExtra.scrollButton,resizeButtonStyles:window.HkStylesExtra.resizeButton,headerStyles:window.HkStylesExtra.header,titleStyles:window.HkStylesExtra.title,reduceButtonStyles:window.HkStylesExtra.reduceButton,closeButtonStyles:window.HkStylesExtra.closeButton,updateButtonStyles:window.HkStylesExtra.updateButton,updateLinkStyles:window.HkStylesExtra.updateLink,contentStyles:window.HkStylesExtra.content,},initialize:function(x){this.setOptions(x);this.options.scrollers.up=this.scrollUp;this.options.scrollers.down=this.scrollDown},createWindow:function a(y,au){this.setOptions(au);var ar=this.getWindowId(y,au);var x=new Element("div",{id:ar,"class":"HkWindow Radius5BottomLeft Radius10TopLeft Radius10TopRight",styles:this.options.windowStyles});var ao;if(this.options.createContentContainer){ao=this.createContentContainer(y,au)}else{ao=new Object}if(this.options.createHeader){var at=this.createHeader(y,au);x.adopt(at);if(this.options.draggable){new Drag.Move(x,{handle:at,hkWindow:this,hkWindowId:y,onComplete:function(av){window.console.log("[HkWindow][DEBUG]Drag Complete Event an "+this.options.hkWindowId);if(!this.options.hkWindow.saveWindowPosition(this.options.hkWindowId,this.options.hkWindow.options)){window.console.log("[HkWindow][DEBUG]Drag Event Handler saveWindowPosition fehlgeschlagen für "+x.hkWindowId)}}})}}if(this.options.createContentContainer){x.adopt(ao)}var aq=this.createFooter(y,au);if(this.options.resizeable){window.console.log("[HkWindow][DEBUG]Erzeuge Resize-Button für "+y);var ap=this.createResizeButton(y,au);aq.adopt(ap)}if(this.options.scrollable&&!this.options.autoScroll){var an=this.createScrollArea(y,au);aq.adopt(an)}x.adopt(aq);if(this.options.addToDOM){$("MainContainer").adopt(x);if(this.options.resizeable){this.makeResizeable(y,au,ao)}if(this.options.scrollable&&this.options.autoScroll){this.makeScrollable(y,{scroll:ao})}this.windows.push(x)}this.loadWindowPosition(y,au);return x},getWindowNode:function k(an,x){window.console.log("[HkWindow][DEBUG]Rufe Fenster-Knoten für "+an);var y=$(this.getWindowId(an,x));return"undefined"==typeof y?null:y},getWindowPosition:function n(ao,x){var y=this.getWindowNode(ao,x);if(y==null){return null}var an=y.getPosition();window.console.log("[HkWindow][DEBUG]Abgerufene Fensterposition für  "+y.id+": "+Json.toString(an));return an},setWindowPosition:function Q(ap,ao,x){var an=this.getWindowNode(ao,x);if(an==null){return null}window.console.log("[HkWindow][DEBUG]Setze Fensterposition für  "+an.id+": "+Json.toString(ap));if("undefined"==typeof ap||!ap||!("x" in ap)||!("y" in ap)){return null}var y={top:ap.y,left:ap.x};an.setStyles(y);return y},loadWindowPosition:function m(ap,x){var an=this.getWindowNode(ap,x);if(an==null){return null}var y="WindowPosition"+an.id;var ao=this.storage.pull(y);window.console.log("[HkWindow][DEBUG]Geladene Fensterposition für  "+y+": "+Json.toString(ao));if("undefined"==typeof ao||!ao||!("x" in ao)||!("y" in ao)){ao=this.saveWindowPosition(ap,x)}this.setWindowPosition(ao,ap,x);return ao},saveWindowPosition:function ai(ap,x){var an;if((an=this.getWindowNode(ap,x))==null){return null}var y="WindowPosition"+an.id;var ao=this.getWindowPosition(ap,x);window.console.log("[HkWindow][DEBUG]Speichere Fensterposition für  "+y+": "+Json.toString(ao));this.storage.push(y,ao);return ao},showScrollButtons:function ak(y,x){},hideScrollButtons:function A(y,x){},createFooter:function F(ap,an){this.setOptions(an);var ao=this.getId("HkWindowFooter",ap,an);var x=new Element("div",{id:ao,"class":"Radius5BottomLeft",styles:this.options.footerStyles});if(this.options.createDonateButton){var y=new Element("form",{action:"https://www.paypal.com/cgi-bin/webscr",method:"post",target:"_blank",alt:"Unterstütze den Entwickler!",title:"Unterstütze den Entwickler!",name:"Unterstütze den Entwickler!",styles:this.options.donateStyles});y.innerHTML='<input type="hidden" name="cmd" value="_s-xclick"><input type="hidden" name="hosted_button_id" value="WRWUH9K7JBMBY"><input type="image" src="http://icons.iconarchive.com/icons/visualpharm/magnets/16/coins-icon.png" border="0" name="submit" title="Den Entwickler unterstützen!" name="Den Entwickler unterstützen!" alt="Den Entwickler unterstützen!"><img alt="" border="0" src="https://www.paypalobjects.com/de_DE/i/scr/pixel.gif" width="1" height="1">';x.adopt(y)}return x},createScrollArea:function C(ao,x){this.setOptions(x);var y=this.getId("HkWindowScrollers",ao,x);var an=new Element("div",{id:y,styles:this.options.scrollAreaStyles});$each(this.options.scrollers,function(ar,ap){var aq=this.createScrollButton(ao,x,ap,ar);an.adopt(aq)}.bind(this));return an},createScrollButton:function H(aq,x,ao,y){this.setOptions(x);if(ao!="up"&&ao!="down"){ao="down"}var ap=this.getId("HkWindowScroll"+ao,aq,x);var an=new Element("img",{id:ap,src:"http://icons.iconarchive.com/icons/saki/nuoveXT/16/Small-arrow-"+ao+"-icon.png",styles:this.options.scrollButtonStyles});an.dir=ao;an.srcId=aq;an.btnId=ap;an.btnOpts=x;an.btnWindow=this;an.addEvent("click",y.bind(this));return an},scrollUp:function O(an){window.console.log("[HkWindow][DEBUG]scrollUp:");var ap=an.target.btnWindow.getWindowId(an.target.srcId,an.target.btnOpts);window.console.log("[HkWindow][DEBUG]Fenster-ID: "+ap);var y=$(ap).getElement(".HkContent");window.console.log(y.getSize());var ao=y.getSize().size;var x=y.getSize().scroll;var aq=y.getSize().scrollSize;var ar=x.y-20<0?0:x.y-20;window.console.log("[HkWindow][DEBUG]Scrolle zu Y="+ar);y.scrollTo(x.x,ar);window.console.log(y.getSize())},scrollDown:function I(an){window.console.log("[HkWindow][DEBUG]scrollDown:");var ap=an.target.btnWindow.getWindowId(an.target.srcId,an.target.btnOpts);window.console.log("[HkWindow][DEBUG]Fenster-ID: "+ap);var y=$(ap).getElement(".HkContent");window.console.log(y.getSize());var ao=y.getSize().size;var x=y.getSize().scroll;var aq=y.getSize().scrollSize;var ar=x.y+ao.y+20>aq.y?aq.y-ao.y:x.y+20;window.console.log("[HkWindow][DEBUG]Scrolle zu Y="+ar);y.scrollTo(x.x,ar);window.console.log(y.getSize())},getId:function aj(y,an,x){return y+$pick($pick(an,this.options.id),this.id)},getWindowId:function aa(y,x){return this.getId("HkWindow",y,x)},createHeader:function u(ar,ao){this.setOptions(ao);var ap=this.getId("HkWindowHeader",ar,ao);var y=new Element("div",{id:ap,"class":"HkWindowHeader GradientGreyDarkgreyGrey Radius10TopLeft Radius10TopRight",styles:this.options.headerStyles});if(this.options.reduceable){var x=this.createReduceButton(ar,ao);y.adopt(x)}if(this.options.updateable){var an=this.createUpdateButton(ar,ao);y.adopt(an)}if(this.options.createTitle){var aq=this.createTitle(ar,ao);y.adopt(aq)}return y},createTitle:function s(ao,x){this.setOptions(x);var y=this.getId("HkWindowTitle",ao,x);var an=new Element("h1",{id:y,"class":"HkWindowTitle Radius10TopLeft Radius10TopRight",styles:this.options.titleStyles});an.setText(this.options.title);if(this.options.preventTextSelection){an.preventTextSelection()}if(this.options.draggable){new Drag.Move($(this.getWindowId(ao,x)),{handle:an});an.setStyles({cursor:"move"})}return an},createUpdateButton:function am(ao,an){this.setOptions(an);var x=new Element("a",{href:this.options.updateUrl,target:"_blank",styles:this.options.updateLinkStyles});var y=new Element("img",{alt:"Erzwinge Aktualisierung",title:"Erzwinge Aktualisierung",name:"Erzwinge Aktualisierung",src:"http://icons.iconarchive.com/icons/saki/snowish/16/Apps-system-software-update-icon.png",styles:this.options.updateButtonStyles});x.adopt(y);if(this.options.preventTextSelection){x.preventTextSelection()}return x},createCloseButton:function ae(an,y){this.setOptions(y);var x=new Element("div",{"class":"HkClose HkButton",styles:this.options.closeButtonStyles});return x},createContentContainer:function W(ao,y){this.setOptions(y);var an=this.getId("HkWindowContent",ao,y);var x=new Element("div",{id:an,"class":"HkContent",styles:this.options.contentStyles});if(this.options.preventTextSelection){x.preventTextSelection()}return x},makeScrollable:function p(an,y){this.setOptions(y);if(!this.options.scroll||!this.options.autoScroll){return}var x=$(this.options.scroll);this.options.scroller=new Scroller(x);this.options.scroller.start()},createReduceButton:function Y(an,y){this.setOptions(y);var x=new Element("div",{"class":"HkReduce HkButton",title:"Einrollen",name:"Einrollen",styles:this.options.reduceButtonStyles});x.setOpacity("0.8");if(this.options.preventTextSelection){x.preventTextSelection()}return x},makeReduceable:function e(ap,an){this.setOptions(an);if(!this.options.reduce){return}var ao=$(this.options.reduce);var y=$(this.getWindowId(ap)).getElementsByTagName("div");var x=false;$each(y,function(aq){aq=$(aq);if(aq.hasClass("HkReduce")){x=aq}});if(x&&ao){new Hk.HkReducer(x,ao,{hkWindowId:ap,hkWindow:this})}},createResizeButton:function N(ao,x){var an=this.getId("HkWindowResize",ao,x);var y=new Element("div",{id:an,"class":"HkWindowResizeButton",styles:this.options.resizeButtonStyles});if(this.options.preventTextSelection){y.preventTextSelection()}return y},makeResizeable:function b(ao,y,x){this.setOptions(y);if(!this.options.resizeable){return}var an=this.getId("HkWindowResize",ao,y);x=$(($defined(x)?x:this.getId("HkWindow",ao,y)));this.resizeElement=$(x);window.console.log("[HkWindow][DEBUG]Erzeuge Resizeable-Funktion via "+an);new Drag.Base(x,{handle:$(an),hkResize:this.resizeElement,hkWindow:this,hkWindowId:ao,modifiers:{x:"width",y:"height"},onStart:function(ap){window.console.log("[HkWindow][Event]Resize Start Event an "+this.options.hkWindowId)},onDrag:function(ap){window.console.log("[HkWindow][Event]Resize Event an "+this.options.hkWindowId)},onComplete:function(ap){window.console.log("[HkWindow][Event]Resize Complete Event an "+this.options.hkWindowId);if(this.options.hkWindow.options.reduceable){window.console.log("[HkWindow][DEBUG]Löse Höhenfestlegung durch Reduceable für "+this.options.hkWindowId);var aq=ap.getParent();if(aq.getStyle("overflow")=="hidden"&&aq.getStyle("height")!="auto"){aq.setStyle("height","auto")}}if(!this.options.hkWindow.saveWindowSize(this.options.hkWindowId,this.options.hkWindow.options)){window.console.log("[HkWindow][WARN]Resize Event Handler saveWindowSize fehlgeschlagen für "+this.options.hkWindowId)}}})},getWindowSize:function S(ao,x){var an=this.resizeElement||this.getWindowNode(ao,x);if(an==null){return null}var y=an.getSize();window.console.log("[HkWindow][DEBUG]Abgerufene Fenstergröße für  "+an.id+": "+Json.toString(y));return y},setWindowSize:function j(an,ap,y){var ao=this.resizeElement||this.getWindowNode(ap,y);if(ao==null){return null}window.console.log("[HkWindow][DEBUG]Setze Fenstergröße für  "+ao.id+": "+Json.toString(an));if("undefined"==typeof an||!an||!("size" in an)||!("x" in an.size)||!("y" in an.size)){return null}var x={width:an.size.x,height:an.size.y};ao.setStyles(x);return x},loadWindowSize:function ag(ap,x){var ao=this.resizeElement||this.getWindowNode(ap,x);if(ao==null){return null}var an="WindowSize"+ao.id;var y=this.storage.pull(an);window.console.log("[HkWindow][DEBUG]Geladene Fenstergröße für  "+an+": "+Json.toString(y));if("undefined"==typeof y||!y||!("size" in y)||!("x" in y.size)||!("y" in y.size)){y=this.saveWindowSize(ap,x)}this.setWindowSize(y,ap,x);return y},saveWindowSize:function al(ap,x){var ao=this.resizeElement||this.getWindowNode(ap,x);if(ao==null){return null}var an="WindowSize"+ao.id;var y=this.getWindowSize(ap,x);window.console.log("[HkWindow][DEBUG]Speichere Fenstergröße für  "+an+": "+Json.toString(y));this.storage.push(an,y);return y}});Hk.HkWindows.implement(new Events,new Options);hk.Windows=new Hk.HkWindows();Hk.Shortcut=new Class({$debug:1,options:{x:-1,y:-1,name:""},initialize:function l(an,aq,ap){var ao;if(arguments.length==1){ao=an}else{ao={x:an,y:aq,name:ap}}this.setOptions(ao)},isValid:function f(){var x=window.hk.validatePosition(this.x());var y=window.hk.validatePosition(this.y());if(!x||!y){return false}return this.name().length>0},x:function V(){return this.options.x},y:function T(){return this.options.y},name:function r(){return this.options.name},toString:function i(){return Json.toString(this.options)}});Hk.Shortcut.implement(new Options);hk.Storage.Shortcuts=new Hk.HkStorage({storageKey:window.hk.idScript+"HkShortcuts"+window.hk.PlayerId+""+window.hk.WorldId,});if(hk.Storage.Shortcuts.isEmpty()){var g=window.hk.Storage.Common.pull();if(g){$each(g,function(y,x){if(x!="WindowPositionHkWindowHkShortcuts"&&x!="WindowPositionHkWindowHkExplorer"){window.hk.Storage.Shortcuts.push(x,y)}else{window.hk.Storage.Common.pull(x)}})}}Hk.HkShortcutsWindow=new Class({$debug:1,$cleanStorage:0,$hkWin:false,inputStyles:{valid:{border:"1px solid #030303"},error:{border:"1px solid #fa0c0c"}},initialize:function l(){if(this.$debug==1){window.hk.Storage.Shortcuts.$debug=1;window.hk.Storage.Common.$debug=1;window.hk.$debug=1}if(this.$cleanStorage==1&&!window.hk.Storage.Common.isEmpty()){window.console.log("[HkShortcutsWindow][DEBUG]Leere Shortcut-Speicher...");window.hk.Storage.Shortcuts.dropAll()}if(window.hk.Storage.Shortcuts.isEmpty()){window.console.log("[HkShortcutsWindow][DEBUG]Shortcut-Speicher leer, versuche Migration\u2026");var x=window.hk.Storage.Common.pull();window.console.log("[HkShortcutsWindow][DEBUG]Migrationsdaten: "+Json.toString(x));if(x){$each(x,function(an,y){window.console.log("[HkShortcutsWindow][DEBUG]Verarbeite "+y);if(y!="WindowPositionHkWindowHkShortcuts"&&y!="WindowPositionHkWindowHkExplorer"){window.hk.Storage.Shortcuts.push(y,an);window.hk.Storage.Common.drop(y)}else{window.hk.Storage.Common.drop(y)}})}}window.hk.Storage.Shortcuts.addEvent("onStorageUpdate",this.updateShortcutList);this.$hkWin=window.hk.Windows.createWindow("HkShortcuts",{title:"HkShortcuts"});this.createContent(this.$hkWin,window.hk.Windows,window.hk.Storage.Shortcuts)},cleanStorage:function(y){if(y.isEmpty()){window.console.log("[HkShortcutsWindow][DEBUG]Leere Speicher #"+y.options.storageKey);var x=window.hk.Storage.Common.pull();window.console.log("[HkShortcutsWindow][DEBUG]Migrationsdaten: "+Json.toString(x));if(x){$each(x,function(ao,an){window.console.log("[HkShortcutsWindow][DEBUG]Verarbeite "+an);if(an!="WindowPositionHkWindowHkShortcuts"&&an!="WindowPositionHkWindowHkExplorer"){window.hk.Storage.Shortcuts.push(an,ao)}else{window.hk.Storage.Common.drop(an)}})}}},loadCurrentPosition:function X(){window.console.log("[HkShortcutsWindow][DEBUG]Lade Shortcut...");$("ShortcutInputX").value=window.hk.getCurrentX();window.hk.Shortcuts.validateData("ShortcutInputX");$("ShortcutInputY").value=window.hk.getCurrentY();window.hk.Shortcuts.validateData("ShortcutInputY");var x=window.hk.getRegionName(window.hk.getCurrentX(),window.hk.getCurrentY());$("ShortcutInputName").value=x},resetData:function af(x){var y;if($chk(x)&&x){y=this.inputStyles.error.border}else{y=this.inputStyles.valid.border}$("ShortcutInputX").value="";$("ShortcutInputX").setStyles({border:y});$("ShortcutInputY").value="";$("ShortcutInputY").setStyles({border:y})},validateData:function o(y){var x=$(y).value;if(window.hk.validatePosition(x)){$(y).setStyle("border",this.inputStyles.valid.border)}},getCurrentData:function J(){var ap=$("ShortcutInputX").value;var aq=$("ShortcutInputY").value;var ao=$("ShortcutInputName").value;var an=new window.Hk.Shortcut(ap,aq,ao);return an},createShortcut:function P(y){y.preventDefault();var x=window.hk.Shortcuts.getCurrentData();if(x.isValid()){window.hk.Storage.Shortcuts.push(x.name(),x.options)}else{this.resetData(true)}},shortcutClicked:function ah(aq){window.console.log("[HkShortcutsWindow][DEBUG]Rufe Shortcut auf");var ar=aq.target;window.console.log("[HkShortcutsWindow][DEBUG]Shortcut-Eintrag: "+ar);while(ar.getTag()!="div"){ar=ar.getParent();window.console.log("[HkShortcutsWindow][DEBUG]Shortcut-Eintrag: "+ar)}var ap=ar.getProperty("name");window.console.log("[HkShortcutsWindow][DEBUG]Rufe Werte des Eintrags "+ap+" ab");var ao=window.hk.Storage.Shortcuts.pull(ap);window.console.log("[HkShortcutsWindow][DEBUG]Werte des Eintrags: "+Json.toString(ao));var an=ao.x;var at=ao.y;window.console.log("[HkShortcutsWindow][DEBUG]Gehe zu Shortcut: "+an+", "+at);window.hk.gotoPosition(an,at)},gotoCurrentPosition:function B(){var x=window.hk.Shortcuts.getCurrentData();window.hk.gotoPosition(x.x(),x.y())},updateShortcutList:function w(){window.console.log("[HkShortcutsWindow][DEBUG]Aktualisiere Shortcut-Liste");$("ShortcutList").empty();var x=window.hk.Storage.Shortcuts.pull();if(x){$each(x,function(ao,an){var y=new window.Hk.Shortcut(ao);window.hk.Shortcuts.addShortcutToList(y)})}window.hk.Shortcuts.updateDimensions()},updateDimensions:function M(){var x=$("ShortcutList").getElementsByTagName("div");$each(x,function(y){var an=$(y).getStyle("height");if($chk(an)&&an.toInt()<=0){y.setStyle("height","auto")}});$("ShortcutList").setStyle("height","auto")},addShortcutToList:function U(x){window.console.log("[HkShortcutsWindow][DEBUG]Shortcut: "+Json.toString(x.options));var ao=x.name()+"   ("+x.x()+", "+x.y()+")";window.console.log("[HkShortcutsWindow][DEBUG]Shortcut: "+ao);var an=new Element("p",{"class":"EntryText EntryLink",styles:window.HkStylesExtra.Shortcuts.Entry.text});an.setText(ao);an.preventTextSelection();an.addEvent("click",this.shortcutClicked);var ap=new Element("img",{"class":"EntryButton DeleteButton",name:"delete"+x.name(),title:"Eintrag löschen",alt:"Eintrag löschen",src:"http://icons.iconarchive.com/icons/oxygen-icons.org/oxygen/16/Actions-dialog-close-icon.png",styles:window.HkStylesExtra.Shortcuts.Entry.deleteButton});ap.addEventListener("click",this.onDeleteShortcut);var y=new Element("div",{"class":"hkScLEntry",name:x.name(),styles:window.HkStylesExtra.Shortcuts.Entry.entry});y.adopt(ap);y.adopt(an);an.addEventListener("click",this.shortcutClicked);$("ShortcutList").adopt(y)},onDeleteShortcut:function v(an){window.console.log("[HkShortcutsWindow][DEBUG]Rufe Shortcut auf");var ao=an.target;window.console.log("[HkShortcutsWindow][DEBUG]Shortcut-Eintrag: "+ao);while(ao.getTag()!="div"){ao=ao.getParent();window.console.log("[HkShortcutsWindow][DEBUG]Shortcut-Eintrag: "+ao)}var y=ao.getProperty("name");window.console.log("[HkShortcutsWindow][DEBUG]Entferne Eintrag "+y+"\u2026");var x=window.hk.Storage.Shortcuts.drop(y);window.console.log("[HkShortcutsWindow][DEBUG]Entfernter Eintrag: "+Json.toString(x));window.hk.Shortcuts.updateDimensions()},nameInputHasFocus:function h(x){if(!($chk($("ShortcutInputX").value)||$chk($("ShortcutInputY").value))){window.hk.Shortcuts.loadCurrentPosition()}},inputFocusLost:function G(x){window.hk.Shortcuts.validateData(x.target.id)},createContent:function L(y,ao,ax){var ap=y.getElement(".HkContent");ap.setStyle("paddingTop","0px");var ar=new Element("form",{id:"ShortcutForm",name:"inputForm"});ar.setStyles({paddingTop:"0px",verticalAlign:"middle"});ar.addEventListener("submit",this.createShortcut);var an=new Element("div",{id:"ShortcutList",styles:window.HkStylesExtra.Shortcuts.list});var au=new Element("input",{id:"ShortcutInputX",name:"inputX",size:3,maxlength:3,styles:window.HkStylesExtra.Shortcuts.Form.inputX});au.addEventListener("blur",this.inputFocusLost);var at=new Element("input",{id:"ShortcutInputY",name:"inputY",size:3,maxlength:3,styles:window.HkStylesExtra.Shortcuts.Form.inputY});at.addEventListener("blur",this.inputFocusLost);var aq=new Element("input",{id:"ShortcutInputName",name:"inputName",styles:window.HkStylesExtra.Shortcuts.Form.inputName});aq.addEventListener("focus",this.nameInputHasFocus);var aw=new Element("img",{id:"GotoPosition",name:"gotoPosition",alt:"Springe zu angegebenen Koordinaten",title:"Springe zu angegebenen Koordinaten",src:"http://icons.iconarchive.com/icons/itzikgur/my-seven/16/Favorities-icon.png",styles:window.HkStylesExtra.Shortcuts.Form.gotoPosition});aw.preventTextSelection();aw.addEventListener("click",this.gotoCurrentPosition);var av=new Element("img",{id:"LoadPosition",name:"loadPosition",alt:"Lade Informationen der aktuellen Kartenposition",title:"Lade Informationen der aktuellen Kartenposition",src:"http://icons.iconarchive.com/icons/fatcow/farm-fresh/16/update-icon.png",styles:window.HkStylesExtra.Shortcuts.Form.load});av.preventTextSelection();av.addEventListener("click",this.loadCurrentPosition);var x=new Element("img",{id:"ShortcutSubmit",name:"shortcutSubmit",alt:"Speichern",title:"Speichern",src:"http://icons.iconarchive.com/icons/fatcow/farm-fresh/16/accept-icon.png",styles:window.HkStylesExtra.Shortcuts.Form.submit});x.preventTextSelection();x.addEventListener("click",this.createShortcut);ar.adopt(au,at,aw,av,x,aq);ap.adopt(ar,an)}});Hk.HkShortcutsWindow.implement(new Events,new Options);window.initHkToolkit=function D(){window.console.log("[HkPublic][DEBUG]Initialisiere HkToolkit\u2026");try{window.hk.Shortcuts=new window.Hk.HkShortcutsWindow()}catch(x){window.console.log("[HkPublic][ERROR]Fehler beim Erzeugen des Shortcuts-Fensters: "+x)}try{window.hk.Shortcuts.updateShortcutList()}catch(x){window.console.log("[HkPublic][ERROR]Fehler beim Aktualisieren des Shortcuts-Fensters: "+x)}try{window.hk.Windows.makeReduceable("HkShortcuts",{reduce:$("HkWindowContentHkShortcuts"),title:"HkShortcuts"})}catch(x){window.console.log("[HkPublic][ERROR]Fehler bei der Finalisierung des Shortcuts-Fensters: "+x)}try{window.hk.Windows.makeScrollable("HkShortcuts",{scroll:$("HkWindowContentHkShortcuts"),title:"HkShortcuts",autoScroll:true});window.hk.Shortcuts.updateDimensions()}catch(x){window.console.log("[HkPublic][ERROR]Fehler bei der Finalisierung des Shortcuts-Fensters: "+x)}if("undefined"==typeof window.hkStylesGeneric){try{window.hkStylesGeneric=new window.HkStylesGeneric()}catch(x){window.console.log("[HkPublic][ERROR]Fehler bei der Finalisierung des Shortcuts-Fensters: "+x)}}window.hkStylesGeneric.applyStyles()};return window.initHkToolkit}}window.HkShortcutsDependentObjectsAvailable=function(){try{return window.Hk&&window.hk&&window.Hk.HkWindows&&window.hk.Windows}catch(a){return false}};window.console.log("Erzeuge Loader-Objekt\u2026");if(!window.hasOwnProperty("HkShortcutsLoader")){window.HkShortcutsLoader={loaded:false,load:function load(){if(window.HkShortcutsLoader.loaded){window.console.log("[HkShortcutsLoader][DEBUG]HkShortcuts geladen\u2026");try{window.HkShortcutsLoaderActive=$clear(window.HkShortcutsLoaderActive)}catch(b){window.console.log("[HkShortcutsLoader][Error]Fehler beim Beenden des Loaders: "+b)}return}window.console.log("[HkShortcutsLoader][DEBUG]Warte auf Objekte\u2026");if(!!(window.HkShortcutsAssetLoader&&window.HkShortcutsAssetLoader.waiting.length==0&&window.HkShortcutsCreateClasses&&window.HkShortcutsDependentObjectsAvailable&&window.HkShortcutsDependentObjectsAvailable())){window.console.log("[HkShortcutsLoader][DEBUG]Objekte verfügbar, bereite HkShortcuts vor\u2026");try{window.HkShortcutsLoader.loaded=true;var a=window.HkShortcutsCreateClasses();a()}catch(b){window.console.log("[HkShortcutsLoader][ERROR]Fehler beim Erzeugen der Klassen für HkShortcuts: "+b)}}else{window.console.log("[HkShortcutsLoader][DEBUG]HkShortcuts wartet auf die Verfügbarkeit von Objekten.")}}}}window.console.log("Starte Loader\u2026");try{if(!window.hasOwnProperty("HkShortcutsLoaderActive")){window.HkShortcutsLoaderActive=window.HkShortcutsLoader.load.periodical(1000)}}catch(ex){window.console.log("[HkPublic][DEBUG]Fehler beim Laden von HkShortcuts: "+ex)};